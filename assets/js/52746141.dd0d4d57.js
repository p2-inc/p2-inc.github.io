"use strict";(self.webpackChunkphasetwo_docs=self.webpackChunkphasetwo_docs||[]).push([[8009],{603905:function(e,t,o){o.d(t,{Zo:function(){return u},kt:function(){return d}});var n=o(667294);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},u=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var o=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),h=c(o),d=r,m=h["".concat(l,".").concat(d)]||h[d]||p[d]||i;return o?n.createElement(m,a(a({ref:t},u),{},{components:o})):n.createElement(m,a({ref:t},u))}));function d(e,t){var o=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=o.length,a=new Array(i);a[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,a[1]=s;for(var c=2;c<i;c++)a[c]=o[c];return n.createElement.apply(null,a)}return n.createElement.apply(null,o)}h.displayName="MDXCreateElement"},363938:function(e,t,o){o.r(t),o.d(t,{assets:function(){return u},contentTitle:function(){return l},default:function(){return d},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return p}});var n=o(583117),r=o(480102),i=(o(667294),o(603905)),a=["components"],s={id:"sso-without-auth",title:"SSO Without Auth"},l=void 0,c={unversionedId:"sso/sso-without-auth",id:"sso/sso-without-auth",title:"SSO Without Auth",description:"Many Phase Two customers use their own authentication and user management systems, and only rely on Phase Two for its comprehensive SSO support. It is not required to use both in order to get the full power of our SSO integrations and customer self-management portal.",source:"@site/docs/sso/sso-without-auth.md",sourceDirName:"sso",slug:"/sso/sso-without-auth",permalink:"/docs/sso/sso-without-auth",draft:!1,editUrl:"https://github.com/p2-inc/phasetwo-docs/tree/master/docs/sso/sso-without-auth.md",tags:[],version:"current",frontMatter:{id:"sso-without-auth",title:"SSO Without Auth"},sidebar:"docs",previous:{title:"Wizards",permalink:"/docs/sso/wizards"},next:{title:"Organizations",permalink:"/docs/organizations/"}},u={},p=[{value:"Authentication flow setup",id:"authentication-flow-setup",level:3},{value:"Add identity provider redirect to your application",id:"add-identity-provider-redirect-to-your-application",level:3}],h={toc:p};function d(e){var t=e.components,o=(0,r.Z)(e,a);return(0,i.kt)("wrapper",(0,n.Z)({},h,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Many Phase Two customers use their own authentication and user management systems, and only rely on Phase Two for its comprehensive SSO support. It is not required to use both in order to get the full power of our SSO integrations and customer self-management portal."),(0,i.kt)("h3",{id:"authentication-flow-setup"},"Authentication flow setup"),(0,i.kt)("p",null,"In order to set up Phase Two for SSO only, there are a few steps you must take."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"When you are setting up your customer IdP, make a note of the alias you use. It is required to make it unique, and it is also recommended to make it something that is memorable and easy to associate with the customer. For example, ",(0,i.kt)("inlineCode",{parentName:"li"},"acme-corp-saml"),"."),(0,i.kt)("li",{parentName:"ol"},"In the ",(0,i.kt)("strong",{parentName:"li"},"Authentication")," section of the Admin UI, select the ",(0,i.kt)("strong",{parentName:"li"},"SSO Only")," flow, and then use the ",(0,i.kt)("strong",{parentName:"li"},"Bind flow")," function of the action menu in the upper right to bind this flow to the ",(0,i.kt)("strong",{parentName:"li"},"Browser flow"),".")),(0,i.kt)("h3",{id:"add-identity-provider-redirect-to-your-application"},"Add identity provider redirect to your application"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Import the ",(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/keycloak-js"},"keycloak-js")," Javascript library into your code, and initialze as documented in the ",(0,i.kt)("a",{parentName:"li",href:"../securing-applications/javascript"},"Securing Applications")," section.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"  var keycloak = new Keycloak();\n  keycloak.init().then(function(authenticated) {\n    console.log(authenticated ? 'authenticated' : 'not authenticated');\n  }).catch(function() {\n    console.log('failed to initialize');\n  });\n")),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"When you want to send the user to their SSO provider, set the ",(0,i.kt)("inlineCode",{parentName:"li"},"idpHint")," parameter to the alias you used in Step 1. Refer to the documentation on ",(0,i.kt)("a",{parentName:"li",href:"https://www.keycloak.org/docs/latest/securing_apps/#login-options"},"options")," to control other features. Note that if you do not specify an ",(0,i.kt)("inlineCode",{parentName:"li"},"idpHint")," parameter in the options variable, the login flow will automatically fall back to using the email domain rules you have specified to help the user find their SSO IdP using their email address.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'  // call the login function with the following options in order to initiate the SSO login flow\n  var options = { prompt: "login", idpHint: "acme-corp-saml" };\n  keycloak.login(options);\n')),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},"Once the user has complete the SSO login flow, the keycloak-js library will handle processing the secure token flow with Phase Two, and will then redirect the user to the page where you initiated the login flow (or where you directed it to based on the ",(0,i.kt)("inlineCode",{parentName:"li"},"redirectUri")," value in the options variable). In order to capture the information received from the user IdP, you must register the ",(0,i.kt)("inlineCode",{parentName:"li"},"onAuthSuccess")," callback function. It is also good practice to register ",(0,i.kt)("inlineCode",{parentName:"li"},"onAuthError")," to catch problems with the user SSO authentication process.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'  keycloak.onAuthSuccess = function () {\n    token = keycloak.tokenParsed;\n    // do something with the result\n    console.log("Email", token[\'email\']);\n    console.log("First Name", token[\'given_name\']);\n    console.log("Last Name", token[\'family_name\']);\n  };\n  keycloak.onAuthError = function(errorData) {\n    // do something with the error\n    console.log("Error", errorData.error);\n    console.log("Description", errorData.error_description);\n  };\n')),(0,i.kt)("p",null,"Note that this is very similar to the normal login process when you are using Phase Two as the primary source of user authentication. However, the significant difference is that the keycloak-js adapter is not initialized in a way that requires login (thus making the page inaccessible), and it is your responsibility to store the association between your user and their IdP alias."))}d.isMDXComponent=!0}}]);