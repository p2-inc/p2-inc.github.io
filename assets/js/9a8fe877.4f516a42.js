"use strict";(self.webpackChunkphasetwo_docs=self.webpackChunkphasetwo_docs||[]).push([[4125],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),u=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=u(e.components);return o.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(n),h=a,m=d["".concat(s,".").concat(h)]||d[h]||c[h]||i;return n?o.createElement(m,r(r({ref:t},p),{},{components:n})):o.createElement(m,r({ref:t},p))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var u=2;u<i;u++)r[u]=n[u];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},38745:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return r},default:function(){return c},frontMatter:function(){return i},metadata:function(){return l},toc:function(){return u}});var o=n(83117),a=(n(67294),n(3905));const i={slug:"sso-setup",title:"Setting up SSO with Phase Two and Keycloak",description:"SSO setup and configuration with Phase Two's Hosted Keycloak offering",authors:"phasetwo",tags:["tutorial","keycloak","phase_two","sso"]},r=void 0,l={permalink:"/blog/sso-setup",source:"@site/blog/2022-11-23-sso-setup.md",title:"Setting up SSO with Phase Two and Keycloak",description:"SSO setup and configuration with Phase Two's Hosted Keycloak offering",date:"2022-11-23T00:00:00.000Z",formattedDate:"November 23, 2022",tags:[{label:"tutorial",permalink:"/blog/tags/tutorial"},{label:"keycloak",permalink:"/blog/tags/keycloak"},{label:"phase_two",permalink:"/blog/tags/phase-two"},{label:"sso",permalink:"/blog/tags/sso"}],readingTime:3.44,hasTruncateMarker:!0,authors:[{name:"Phase Two",title:"Hosted Keycloak and Keycloak Support",url:"https://github.com/p2-inc",email:"support@phasetwo.io",imageURL:"https://avatars.githubusercontent.com/u/60152109?s=200&v=4",key:"phasetwo"}],frontMatter:{slug:"sso-setup",title:"Setting up SSO with Phase Two and Keycloak",description:"SSO setup and configuration with Phase Two's Hosted Keycloak offering",authors:"phasetwo",tags:["tutorial","keycloak","phase_two","sso"]},prevItem:{title:"Changing Our License to Elastic License v2 to Enable Hosting and Derivative Works",permalink:"/blog/licensing-change"},nextItem:{title:"Protecting Your Application With Keycloak",permalink:"/blog/securing-apps-with-keycloak"}},s={authorsImageUrls:[void 0]},u=[{value:"Script",id:"script",level:3}],p={toc:u};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"We've received a lot of support requests about the right way to set up ",(0,a.kt)("a",{parentName:"p",href:"https://phasetwo.io/product/sso/"},"SSO")," connections. We've published a 5 minute video showing you how to do it easily. Also, the script is included below in case you miss anything!"),(0,a.kt)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/wAeT07JGhOI",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0}),(0,a.kt)("h3",{id:"script"},"Script"),(0,a.kt)("p",null,"Developers have been asking for concise ",(0,a.kt)("a",{parentName:"p",href:"https://phasetwo.io/docs/sso/"},"setup instructions for SSO"),". You\u2019re here for our enterprise SSO functionality. We hear you. Here\u2019s a quick live setup to show you how easy it is to leverage an open source SSO provider"),(0,a.kt)("p",null,"I\u2019m assuming you have already created a self-serve deployment."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Start by opening the console."),(0,a.kt)("li",{parentName:"ul"},"Navigate to the ",(0,a.kt)("strong",{parentName:"li"},"Organizations")," tab."),(0,a.kt)("li",{parentName:"ul"},"Create a new organization. In this case, set a domain when creating an organization that corresponds to the email domains you want to match to their SSO provider."),(0,a.kt)("li",{parentName:"ul"},"Create a ",(0,a.kt)("strong",{parentName:"li"},"Portal Link")," by selecting it from the action menu of the organization. This is usually meant to be sent to the organization administrator, but in this case, we\u2019ll open this link in an incognito window and configure the identity provider ourselves.")),(0,a.kt)("p",null,"We\u2019ll use the identity provider wizard to setup a SSO connection to Azure AD. I\u2019ve sped this up a bit, but you\u2019ll get an idea of what is happening. Depending on your setup and target identity provider, this will be different."),(0,a.kt)("p",null,"Now let\u2019s secure an application and use our new SSO connection to log in. For this purpose, we\u2019ve got a debugging application on Github you can use to quickly see how a front end application is secured and what data is shared between Phase Two and the application."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Clone our ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/p2-inc/debug-app"},"debug-app")," from github, and open up the ",(0,a.kt)("inlineCode",{parentName:"li"},"frontend")," folder in your favorite editor or IDE."),(0,a.kt)("li",{parentName:"ul"},"Go back to the admin console and navigate to the ",(0,a.kt)("strong",{parentName:"li"},"Clients")," tab. Create a new client. Let\u2019s call it ",(0,a.kt)("inlineCode",{parentName:"li"},"frontend"),". This will be a public OIDC client, with localhost:3001 as the root and redirect uri."),(0,a.kt)("li",{parentName:"ul"},"Get the ",(0,a.kt)("inlineCode",{parentName:"li"},"keycloak.json")," from the configuration and copy it. Paste it into ",(0,a.kt)("inlineCode",{parentName:"li"},"keycloak.json")," to configure your ",(0,a.kt)("inlineCode",{parentName:"li"},"debug-app"),".")),(0,a.kt)("p",null,"Before we continue, we need to configure an authentication flow that does our SSO redirect."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Navigate to the ",(0,a.kt)("strong",{parentName:"li"},"Authentication")," tab, and duplicate the ",(0,a.kt)("strong",{parentName:"li"},"Browser")," flow."),(0,a.kt)("li",{parentName:"ul"},"Add the ",(0,a.kt)("strong",{parentName:"li"},"Home IdP Discovery")," authenticator and move it into the position before the user forms. Configure it to not require a verified domain nor email."),(0,a.kt)("li",{parentName:"ul"},"Finally, using the action menu, bind it to the browser flow.")),(0,a.kt)("p",null,"Go back to the ",(0,a.kt)("inlineCode",{parentName:"p"},"debug-app"),", and let\u2019s try a login using an email domain that matches the one we configured."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"First, run ",(0,a.kt)("inlineCode",{parentName:"li"},"npm i")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"npm start")," to start the debug app, and navigate to http://localhost:3001 in your browser. See that it redirects to the default login."),(0,a.kt)("li",{parentName:"ul"},"Enter the email address in the new email only form."),(0,a.kt)("li",{parentName:"ul"},"We are redirected to the Azure identity provider we set up."),(0,a.kt)("li",{parentName:"ul"},"Log in to Azure, and then we are redirected to back to ",(0,a.kt)("inlineCode",{parentName:"li"},"debug-app"),"."),(0,a.kt)("li",{parentName:"ul"},"Let\u2019s take a look at the token and see the data that came over from Azure.")),(0,a.kt)("p",null,"As a bonus, let\u2019s map some information about the user\u2019s organization memberships into the token in case we need to do something with that information in our application."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Go back to the Admin UI and navigate to the Client we created."),(0,a.kt)("li",{parentName:"ul"},"Select the ",(0,a.kt)("strong",{parentName:"li"},"frontend-dedicated")," client scope."),(0,a.kt)("li",{parentName:"ul"},"Add a mapper by configuration."),(0,a.kt)("li",{parentName:"ul"},"Select the ",(0,a.kt)("strong",{parentName:"li"},"Organization Role")," mapper and configure it as shown."),(0,a.kt)("li",{parentName:"ul"},"Save the configuration.")),(0,a.kt)("p",null,"Now let\u2019s go back to the ",(0,a.kt)("inlineCode",{parentName:"p"},"debug-app")," and reload."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Take a look at the token. It now contains information about the organization we created."),(0,a.kt)("li",{parentName:"ul"},"The user was automatically created and added as a member to the organization when we logged in through the Azure identity provider.")),(0,a.kt)("p",null,"You now have a fully working authentication and enterprise SSO setup for your application. It took about 5 minutes!"),(0,a.kt)("p",null,"In addition, by choosing an open source SSO provider in Keycloak, you have also picked a cost-effective option too. Read more about ",(0,a.kt)("a",{parentName:"p",href:"https://phasetwo.io/blog/open-source-iam/"},"understanding the costs")," of implementing an open source provider for IAM."))}c.isMDXComponent=!0}}]);