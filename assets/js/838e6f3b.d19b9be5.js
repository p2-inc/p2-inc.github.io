"use strict";(self.webpackChunkphasetwo_docs=self.webpackChunkphasetwo_docs||[]).push([[818],{92022:(e,n,t)=>{t.d(n,{Ay:()=>a,RM:()=>s});var i=t(74848),o=t(28453);const s=[];function r(e){const n={a:"a",admonition:"admonition",code:"code",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"We will use the Phase Two Angular example code here, but the logic could easily be applied to any existing application."})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Clone the Phase Two ",(0,i.jsx)(n.a,{href:"https://github.com/p2-inc/examples/",children:"example repo"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Open the Angular ",(0,i.jsx)(n.a,{href:"https://github.com/p2-inc/examples/tree/main/frameworks/angular",children:"folder"})," within ",(0,i.jsx)(n.code,{children:"/frameworks/angular"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"npm install"})," and then ",(0,i.jsx)(n.code,{children:"npm run start"}),". This example leverages ",(0,i.jsx)(n.a,{href:"https://github.com/manfredsteyer/angular-oauth2-oidc",children:"angular-oauth2-oidc"})," OIDC methods."]}),"\n",(0,i.jsxs)(n.li,{children:["We'll review where we configure out Keycloak instance. Open the ",(0,i.jsx)(n.code,{children:"src/app/auth.config.ts"})," file. We will be updating a few values from the prior section where we set up our OIDC client. Taking the values from the OIDC Client Config section, set those values in the code."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:'export const authCodeFlowConfig: AuthConfig = {\n  // Update this with the url and realm of your hosted Keycloak instance\n  issuer: "https://app.phasetwo.io/auth/realms/p2examples",\n  redirectUri: window.location.origin + "/index.html",\n  // Update this to the Client ID you created in the OIDC Client section\n  clientId: "angular",\n  responseType: "code",\n  scope: "openid profile email offline_access",\n  showDebugInformation: true,\n};\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Those are used to configure the ",(0,i.jsx)(n.code,{children:"oauthService"})," in the ",(0,i.jsx)(n.code,{children:"src/app/user/user.component.ts"})," file. In the constructor of the component, this is passed in."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// ...\nconstructor(private oauthService: OAuthService) {\n  this.oauthService.configure(authCodeFlowConfig);\n\n  // required to initialize the client\n  this.oauthService.loadDiscoveryDocumentAndTryLogin();\n  this.oauthService.setupAutomaticSilentRefresh();\n\n  this.oauthService.events\n    .pipe(filter((e) => e.type === 'token_received'))\n    .subscribe((_) => this.oauthService.loadUserProfile());\n}\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"6",children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"UserActivation.component.ts"})," file contains additional methods that will assist with the interaction of the html template."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"For handling login and logout, the following methods are used:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"  signIn() {\n    return this.oauthService.initLoginFlow();\n  }\n\n  signOut() {\n    return this.oauthService.logOut();\n  }\n"})}),"\n",(0,i.jsx)(n.p,{children:"while we also define additional helper methods to get user information (username, email, etc) along with raw Token values. A couple are provided below as an example."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"get userName(): string {\n  const claims = this.oauthService.getIdentityClaims();\n  if (!claims) return '';\n  return claims['given_name'];\n}\n\nget idToken(): string {\n  const token = this.oauthService.getIdToken();\n  if (token) {\n    return this.decodeAndStringifyToken(token);\n  }\n  return '';\n}\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"7",children:["\n",(0,i.jsxs)(n.li,{children:["Switching to the html template for the user component, ",(0,i.jsx)(n.code,{children:"src/app/user/user.component.html"}),", we can see how the login and logout buttons are rendered. The buttons are conditionally rendered based on the user's authentication status based on the presence of the ",(0,i.jsx)(n.code,{children:"idToken"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'<div *ngIf="idToken">\n  \x3c!-- show user data --\x3e\n  \x3c!-- show logout button --\x3e\n</div>\n<div *ngIf="!idToken">\n  \x3c!-- show login button --\x3e\n</div>\n'})}),"\n",(0,i.jsx)(n.p,{children:"The logic using the authenticator to conditionally determine the Authenticated state, can be used to secure routes, components, and more."}),"\n",(0,i.jsxs)(n.ol,{start:"10",children:["\n",(0,i.jsxs)(n.li,{children:["Open ",(0,i.jsx)(n.a,{href:"http://localhost:4200",children:"localhost:4200"}),". You will see the Phase Two example landing page. You current state should be ",(0,i.jsx)(n.strong,{children:"Not authenticated"}),". Click ",(0,i.jsx)(n.strong,{children:"Log In"}),". This will redirect you to your login page."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"Use the non-admin user created in the previous section to sign in."})}),"\n",(0,i.jsxs)(n.ol,{start:"11",children:["\n",(0,i.jsxs)(n.li,{children:["Enter the credentials of the non-admin user you created. Click ",(0,i.jsx)(n.strong,{children:"Submit"}),". You will then be redirected to the application. The Phase Two example landing page now loads your ",(0,i.jsx)(n.strong,{children:"Authenticated"})," state, displaying your user's email and name."]}),"\n",(0,i.jsx)(n.li,{children:"Neat! If you clear the browser state for that tab, then you will have to be redirected away to sign-in again."}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(r,{...e})}):r(e)}},68034:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>h});var i=t(74848),o=t(28453),s=t(92022);const r={id:"angular",title:"Angular"},a=void 0,l={id:"securing-applications/angular",title:"Angular",description:"View a live deployed version.",source:"@site/docs/securing-applications/angular.mdx",sourceDirName:"securing-applications",slug:"/securing-applications/angular",permalink:"/docs/securing-applications/angular",draft:!1,unlisted:!1,editUrl:"https://github.com/p2-inc/phasetwo-docs/tree/main/docs/securing-applications/angular.mdx",tags:[],version:"current",frontMatter:{id:"angular",title:"Angular"},sidebar:"docs",previous:{title:"SvelteKit",permalink:"/docs/securing-applications/sveltekit"},next:{title:"API",permalink:"/docs/api/"}},c={},h=[...s.RM];function d(e){const n={a:"a",p:"p",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["View a ",(0,i.jsx)(n.a,{href:"https://phasetwo-angular-example.vercel.app/",children:"live deployed version"}),"."]}),"\n","\n",(0,i.jsx)(s.Ay,{})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(96540);const o={},s=i.createContext(o);function r(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);