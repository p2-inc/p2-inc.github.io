"use strict";(self.webpackChunkphasetwo_docs=self.webpackChunkphasetwo_docs||[]).push([[55522],{1823:(e,t,n)=>{n.d(t,{A:()=>i});const i="data:image/png;base64,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"},13601:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/3.1.mapper-configuration-5fb3b4a774243f7360c13f6cc65b0ce7.png"},19338:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/5.get-updated-account-607496df88c6e8c90c1980675b760dda.png"},19510:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/1.client-scope-4f8afbb1190858c7155a613eba9014e6.png"},22579:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/5.token-claims-016e6439a145aabcebd920cbfd9162fc.png"},25829:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/4.after-attack-get-org-5c2103d466dc5c1b276f0fa9455eba2b.png"},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var i=n(96540);const a={},s=i.createContext(a);function r(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(s.Provider,{value:t},e.children)}},30645:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/6.switch-org-not-member-083e5e41c508712e2c0766473adca117.png"},49993:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/2.configurable-active-organization-mapper-baa3bcf033bacdc913077b60c33a7a9a.png"},56936:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/3.get-active-org-9e8f406677b1200206d2d5337611e699.png"},57779:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/case-with-no-org-f8c499b8775228a080212b618b24bb32.png"},66539:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/1.get-initial-account-5da20ffe694a2abcbe3fb7ece51acd83.png"},66587:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/4.switch-org-member-c5f7b8222c8a5d54dbee5d09d2d6a3fe.png"},70520:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/3.confirm-attack-2b21c70e684d9d6ec529004c71bb25aa.png"},71524:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/3.mapper-configuration-e1abfdea6c975975e30de2c67c21b776.png"},80793:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/2.get-user-orgs-d9de7e679075644d7d1583f4b03673f8.png"},85789:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/4.configure-client-client-scopes-2e4481ca4d71545dec90250c29ea412a.png"},86516:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>l,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"organizations/active-organization","title":"Active Organization","description":"Currently supported mode","source":"@site/docs/organizations/active-organization.md","sourceDirName":"organizations","slug":"/organizations/active-organization","permalink":"/docs/organizations/active-organization","draft":false,"unlisted":false,"editUrl":"https://github.com/p2-inc/phasetwo-docs/tree/main/docs/organizations/active-organization.md","tags":[],"version":"current","frontMatter":{"id":"active-organization","title":"Active Organization","sidebar_label":"Active Organization"},"sidebar":"docs","previous":{"title":"Identity Providers","permalink":"/docs/organizations/identity-providers"},"next":{"title":"Active Organization Authenticator","permalink":"/docs/organizations/active-organization-authenticator"}}');var a=n(74848),s=n(28453);const r={id:"active-organization",title:"Active Organization",sidebar_label:"Active Organization"},o=void 0,c={},d=[{value:"Currently supported mode",id:"currently-supported-mode",level:2},{value:"Important note (<code>ATTRIBUTE_MODE</code>) before v24.x+",id:"important-note-attribute_mode-before-v24x",level:3},{value:"Authenticator",id:"authenticator",level:2},{value:"Endpoints",id:"endpoints",level:2},{value:"Switch Organization",id:"switch-organization",level:3},{value:"Active organization",id:"active-organization",level:3},{value:"Mappers",id:"mappers",level:2},{value:"New mapper",id:"new-mapper",level:3},{value:"Configure the mapper",id:"configure-the-mapper",level:3},{value:"Standard Flow (Demo)",id:"standard-flow-demo",level:2},{value:"Attack Scenario and Mitigation (before v24.x+)",id:"attack-scenario-and-mitigation-before-v24x",level:2},{value:"Case with user read only attributes",id:"case-with-user-read-only-attributes",level:2},{value:"Case with no user read only attributes",id:"case-with-no-user-read-only-attributes",level:2}];function h(e){const t={a:"a",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h2,{id:"currently-supported-mode",children:"Currently supported mode"}),"\n",(0,a.jsxs)(t.p,{children:['Currently, there is only one supported mode for "active organization" which is based on user\'s attributes (',(0,a.jsx)(t.code,{children:"ATTRIBUTE_MODE"}),"). This means that the active organization is kept in the user's attributes, they don't need to select an organization each time they log in."]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Upon login, the last active organization will be used."}),"\n",(0,a.jsx)(t.li,{children:"If the user doesn't have an active organization attribute and belong to one or more organization, the first one is taken by default."}),"\n",(0,a.jsx)(t.li,{children:"Switching organization create a new session for the user (it return a new access token)."}),"\n"]}),"\n",(0,a.jsxs)(t.h3,{id:"important-note-attribute_mode-before-v24x",children:["Important note (",(0,a.jsx)(t.code,{children:"ATTRIBUTE_MODE"}),") before v24.x+"]}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Starting of the version 24.x+, the org.ro.active is not visible and not editable by standard users."}),"\nCurrently, the attribute key for active organization is not configurable and is by default ",(0,a.jsx)(t.code,{children:"org.ro.active"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["It follows this format as it can be set as read-only with ",(0,a.jsx)(t.code,{children:"--spi-user-profile-declarative-user-profile-read-only-attributes=org.ro.*"})," of Keycloak which is ",(0,a.jsx)(t.strong,{children:"recommended"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsxs)(t.em,{children:["So a standard user isn't able to modify it for any ",(0,a.jsx)(t.a,{href:"#attack-scenario-and-mitigation-before-v24x",children:"malicious purpose"}),".\nIf not set as read-only, some mitigation were implemented"]}),"."]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"authenticator",children:"Authenticator"}),"\n",(0,a.jsxs)(t.p,{children:["For a ",(0,a.jsx)(t.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest",children:"spec-compliant"}),' approach,\nyou can use the "Select Organization" authenticator based on ',(0,a.jsx)(t.code,{children:"prompt=select_account"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"For more information"}),", see the ",(0,a.jsx)(t.a,{href:"/docs/organizations/active-organization-authenticator",children:"active-organization-authenticator"})," doc."]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"endpoints",children:"Endpoints"}),"\n",(0,a.jsx)(t.p,{children:"2 endpoints are available."}),"\n",(0,a.jsx)(t.h3,{id:"switch-organization",children:"Switch Organization"}),"\n",(0,a.jsxs)(t.p,{children:["This ",(0,a.jsx)(t.a,{href:"/api/switch-active-organization",children:"endpoint"})," allow a user to switch organization."]}),"\n",(0,a.jsx)(t.p,{children:"Note that switching organization create a new session for the user."}),"\n",(0,a.jsx)(t.h3,{id:"active-organization",children:"Active organization"}),"\n",(0,a.jsxs)(t.p,{children:["This ",(0,a.jsx)(t.a,{href:"/api/get-active-organization",children:"endpoint"})," allow a user to get its active organization."]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"mappers",children:"Mappers"}),"\n",(0,a.jsx)(t.h3,{id:"new-mapper",children:"New mapper"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"available-mapper",src:n(49993).A+"",width:"813",height:"170"})}),"\n",(0,a.jsx)(t.h3,{id:"configure-the-mapper",children:"Configure the mapper"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"1. Create client scope"})}),"\n",(0,a.jsx)(t.p,{children:"In your realm Client scopes, add a new client-scope, set the configuration and name as you wish."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"client-scope",src:n(19510).A+"",width:"1070",height:"642"})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"2. Use the active organization mapper"})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"available-mapper",src:n(49993).A+"",width:"813",height:"170"})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"3. Configure the mapper"})}),"\n",(0,a.jsx)(t.p,{children:"By default, all properties are pre-configured. You can remove what you want and the mapper will adjust the claim."}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.em,{children:"Example with all pre-configured properties"}),":",(0,a.jsx)(t.br,{}),"\n",(0,a.jsx)(t.img,{alt:"mapper-configuration",src:n(71524).A+"",width:"598",height:"715"})]}),"\n",(0,a.jsx)(t.p,{children:"Will produce this claim in token:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-json",children:'  "active_organization": {\n    "role": [\n      "view-organization",\n      "view-members",\n      "view-roles"\n    ],\n    "name": "My Organization",\n    "id": "75bc86cb-8527-43af-b598-0873fa2bfea6",\n    "attribute": {\n      "test": [\n        "test"\n      ]\n    }\n  },\n'})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.em,{children:"Example with only id property"}),":",(0,a.jsx)(t.br,{}),"\n",(0,a.jsx)(t.img,{alt:"mapper-configuration",src:n(13601).A+"",width:"598",height:"674"})]}),"\n",(0,a.jsx)(t.p,{children:"Will produce this claim in token:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-json",children:'  "active_organization": {\n    "id": "75bc86cb-8527-43af-b598-0873fa2bfea6"\n  },\n'})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"4. Add new client scope to public client"})}),"\n",(0,a.jsx)(t.p,{children:"On your public client (used by your FE application) add the newly created client scope."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"client-client-scopes",src:n(85789).A+"",width:"858",height:"504"})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"5. Token claims"}),(0,a.jsx)(t.br,{}),"\n","Then, after authentication, you should have the active organization info into the token claims."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"token-claims",src:n(22579).A+"",width:"443",height:"303"})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"standard-flow-demo",children:"Standard Flow (Demo)"}),"\n",(0,a.jsx)(t.p,{children:"For this demo,"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"3 different organizations have been created."}),"\n",(0,a.jsxs)(t.li,{children:["1 standard user has been created (with ",(0,a.jsx)(t.code,{children:"manage-account"})," role).","\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"This user was added to Organization 1 and Organization 2."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.li,{children:"1 public client has been created."}),"\n",(0,a.jsxs)(t.li,{children:["1 ",(0,a.jsx)(t.code,{children:"active_organization"}),' client scope has been created with the "Active Organization" pre-configured mapper and assigned to the public client.']}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"The standard user is used for the demo flow."}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"1. Get initial account state."}),(0,a.jsx)(t.br,{}),"\n","First, we get the current account state of the user. Here we can see there is currently no ",(0,a.jsx)(t.code,{children:"org.ro.active"})," attribute."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"initial-account-state",src:n(66539).A+"",width:"551",height:"407"})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"2. Get current user's available organizations."}),(0,a.jsx)(t.br,{}),"\n","There, we get the organizations which the user is a member."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"get-organizations",src:n(80793).A+"",width:"471",height:"750"})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"3. Get current user's active organization."}),(0,a.jsx)(t.br,{}),"\n","We try to get the active organization of the user.",(0,a.jsx)(t.br,{}),"\n","As you may have notified in the account state response,\nthe user doesn't have an active organization attribute, so we have the first one by default."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"get-active-organization",src:n(56936).A+"",width:"567",height:"452"})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"4. Switch to other organization (member)."}),(0,a.jsx)(t.br,{}),"\n","We try to switch to the other organization which the user is a member."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"switch-organization-member",src:n(66587).A+"",width:"954",height:"778"})}),"\n",(0,a.jsxs)(t.p,{children:["As you can see, the request is successful, and we get a new ",(0,a.jsx)(t.strong,{children:"access_token"}),".\nIf you decode this new token, you will see that it contains the new active organization data."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"new-active-organization",src:n(89860).A+"",width:"446",height:"175"})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"5. Get new account state."}),(0,a.jsx)(t.br,{}),"\n","Let's get the user account state."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"new-account-state",src:n(19338).A+"",width:"551",height:"457"})}),"\n",(0,a.jsxs)(t.p,{children:["As you can see, the ",(0,a.jsx)(t.code,{children:"org.ro.active"})," attribute have been populated with the requested organization."]}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"6. Switch to other organization (not a member)."}),(0,a.jsx)(t.br,{}),"\n","Now, let's try to switch to the Organization 3, where the user is not a member."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"switch-organization-not-a-member",src:n(30645).A+"",width:"633",height:"356"})}),"\n",(0,a.jsx)(t.p,{children:"As you can see, the user can't perform this action."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"End."})}),"\n",(0,a.jsxs)(t.p,{children:["Side note, if the user tries to get the active-organization without belonging to an organization,\nthe ",(0,a.jsx)(t.code,{children:"404 NOT FOUND"})," response will be returned."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"no-organization",src:n(57779).A+"",width:"810",height:"236"})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"attack-scenario-and-mitigation-before-v24x",children:"Attack Scenario and Mitigation (before v24.x+)"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"Starting of the version 24.x+, the org.ro.active is not visible and not editable by standard users."})}),"\n",(0,a.jsxs)(t.p,{children:["Now, let's assume the standard user is malicious and knows a little about Keycloak. They may think that they can change organization by directly writing the ",(0,a.jsx)(t.code,{children:"org.ro.active"})," attribute."]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"case-with-user-read-only-attributes",children:"Case with user read only attributes"}),"\n",(0,a.jsxs)(t.p,{children:["If you have defined the pattern ",(0,a.jsx)(t.code,{children:"org.ro.*"})," as read-only as it was recommended in the\n",(0,a.jsx)(t.a,{href:"#important-note-attribute_mode",children:"important note"}),", the user can't modify this attribute."]}),"\n",(0,a.jsxs)(t.p,{children:["They will get a ",(0,a.jsx)(t.code,{children:"400 BAD REQUEST"})," response instead."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"malicious-attack-with-read-only",src:n(95743).A+"",width:"817",height:"787"})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"case-with-no-user-read-only-attributes",children:"Case with no user read only attributes"}),"\n",(0,a.jsxs)(t.p,{children:["Now, if you don't have or can't define the pattern ",(0,a.jsx)(t.code,{children:"org.ro.*"})," as read-only, no need to panic,\nsome mitigation measures have been implemented."]}),"\n",(0,a.jsxs)(t.p,{children:['Let\'s imagine the user is able to make a "successful" ',(0,a.jsx)(t.code,{children:"POST"})," request to modify this attribute."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"malicious-attack-no-read-only",src:n(91513).A+"",width:"801",height:"530"})}),"\n",(0,a.jsxs)(t.p,{children:["As you can see, they will get a ",(0,a.jsx)(t.code,{children:"204 NO CONTENT"})," response (success). Now, they check on its attributes if the action was indeed successful."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"confirm-attack",src:n(70520).A+"",width:"547",height:"469"})}),"\n",(0,a.jsx)(t.p,{children:"Which seems to be the case, as the new active organization id match the one defined in the update account request."}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"However"}),", if they try to get the ",(0,a.jsx)(t.code,{children:"active-organization"})," information now:"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"after-attack-get-org",src:n(25829).A+"",width:"818",height:"232"})}),"\n",(0,a.jsxs)(t.p,{children:["They will get a ",(0,a.jsx)(t.code,{children:"401 UNAUTHORIZED"})," response. It's because we always check that the user actually belongs\nto the organization before returning the information. Also, they may try to re-authenticate to see if the token claims contains the new active organization data (so they can get access to this organization features on your platform)."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"after-attack-token-claim",src:n(1823).A+"",width:"269",height:"29"})}),"\n",(0,a.jsxs)(t.p,{children:["But actually the active organization claims ",(0,a.jsx)(t.strong,{children:"will be empty too"}),". For the same reason as before, we always check that the user actually belongs to the organization before mapping claims into the token."]})]})}function l(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},89860:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/check-new-token-f99cd228af5326f3dead660cd0845172.png"},91513:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/2.malicious-attack-no-read-only-b9270242c38e71d4910d98e277ae6c78.png"},95743:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/1.malicious-attack-with-read-only-24176d09513fe907b313264639f306e1.png"}}]);