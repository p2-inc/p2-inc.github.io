"use strict";(self.webpackChunkphasetwo_docs=self.webpackChunkphasetwo_docs||[]).push([[5159],{3905:function(e,t,i){i.d(t,{Zo:function(){return p},kt:function(){return h}});var n=i(67294);function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function r(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?o(Object(i),!0).forEach((function(t){a(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function s(e,t){if(null==e)return{};var i,n,a=function(e,t){if(null==e)return{};var i,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)i=o[n],t.indexOf(i)>=0||(a[i]=e[i]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)i=o[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(a[i]=e[i])}return a}var d=n.createContext({}),l=function(e){var t=n.useContext(d),i=t;return e&&(i="function"==typeof e?e(t):r(r({},t),e)),i},p=function(e){var t=l(e.components);return n.createElement(d.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var i=e.components,a=e.mdxType,o=e.originalType,d=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(i),h=a,m=u["".concat(d,".").concat(h)]||u[h]||c[h]||o;return i?n.createElement(m,r(r({ref:t},p),{},{components:i})):n.createElement(m,r({ref:t},p))}));function h(e,t){var i=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=i.length,r=new Array(o);r[0]=u;var s={};for(var d in t)hasOwnProperty.call(t,d)&&(s[d]=t[d]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var l=2;l<o;l++)r[l]=i[l];return n.createElement.apply(null,r)}return n.createElement.apply(null,i)}u.displayName="MDXCreateElement"},45724:function(e,t,i){i.r(t),i.d(t,{assets:function(){return d},contentTitle:function(){return r},default:function(){return c},frontMatter:function(){return o},metadata:function(){return s},toc:function(){return l}});var n=i(83117),a=(i(67294),i(3905));const o={id:"identity-providers",title:"Identity providers"},r=void 0,s={unversionedId:"organizations/identity-providers",id:"organizations/identity-providers",title:"Identity providers",description:"Identity providers (IdPs) can be associated with an organization for the purpose of directing users to authenticate with the IdP via a verified email domain, and for automatically granting membership to users who authenticate with that IdP.",source:"@site/docs/organizations/identity-providers.md",sourceDirName:"organizations",slug:"/organizations/identity-providers",permalink:"/docs/organizations/identity-providers",draft:!1,editUrl:"https://github.com/p2-inc/phasetwo-docs/tree/main/docs/organizations/identity-providers.md",tags:[],version:"current",frontMatter:{id:"identity-providers",title:"Identity providers"},sidebar:"docs",previous:{title:"Roles",permalink:"/docs/organizations/roles"},next:{title:"Admin Portal",permalink:"/docs/admin-portal/"}},d={},l=[{value:"Associating an identity provider",id:"associating-an-identity-provider",level:3},{value:"Admin portal",id:"admin-portal",level:4},{value:"Admin UI",id:"admin-ui",level:4},{value:"Verified domains",id:"verified-domains",level:3},{value:"Adding IdP and organization information to the token",id:"adding-idp-and-organization-information-to-the-token",level:3},{value:"Handling user in multiple organization, each with a specific IdP",id:"handling-user-in-multiple-organization-each-with-a-specific-idp",level:3},{value:"API access",id:"api-access",level:3}],p={toc:l};function c(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,n.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Identity providers (IdPs) can be associated with an organization for the purpose of directing users to authenticate with the IdP via a verified email domain, and for automatically granting membership to users who authenticate with that IdP."),(0,a.kt)("h3",{id:"associating-an-identity-provider"},"Associating an identity provider"),(0,a.kt)("p",null,"There are two ways that an IdP can be associated with an organization."),(0,a.kt)("h4",{id:"admin-portal"},"Admin portal"),(0,a.kt)("p",null,"If you have activated the organizations and SSO portions of the admin portal, members of the organization with the appropriate roles can set up their IdPs on their own. When they create and manage IdPs this way, they will be automatcially associated with the user's organization."),(0,a.kt)("h4",{id:"admin-ui"},"Admin UI"),(0,a.kt)("p",null,"The admin UI contains an ",(0,a.kt)("strong",{parentName:"p"},"Identity providers")," section where full details of all IdPs can be created and managed. Also, the IdP wizards that are available to your organization administrators through the admin portal are also available to site administrators by navigating to ",(0,a.kt)("inlineCode",{parentName:"p"},"https://{host}/auth/realms/{realm}/wizard/"),"."),(0,a.kt)("p",null,"Because IdPs created using the admin UI or wizards are done by a site administrator, there is no organization associated by default. To do so, you can navigate to the ",(0,a.kt)("strong",{parentName:"p"},"Organizations")," section, select the organization for assignment and select the ",(0,a.kt)("strong",{parentName:"p"},"Identity providers")," tab. Making the association here will create the necessary relationships with the organization."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Keycloak Phase Two Organizations IDP Association",src:i(25195).Z,width:"755",height:"427"})),(0,a.kt)("h3",{id:"verified-domains"},"Verified domains"),(0,a.kt)("p",null,"The purpose of associating domains with an organization is to allow identity providers to be conditionally shown based on email domain of a user who is logging in. In the ",(0,a.kt)("strong",{parentName:"p"},"Settings")," tab of each organizations, you can add multiple domains. When an authentication flow is configured properly to allow for redirection based on email domain, these are the domains that will be used to look up the associating identity provider."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Keycloak Phase Two Organizations Domains",src:i(37575).Z,width:"1083",height:"569"})),(0,a.kt)("h3",{id:"adding-idp-and-organization-information-to-the-token"},"Adding IdP and organization information to the token"),(0,a.kt)("p",null,'Following a successful login using an IdP associated with an organization, a few values will be set in what are called "User Session Notes".'),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"org_id")," - The ID of the organization associated with the IdP."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"identity_provider")," - The IdP alias of the broker used to perform the login."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"identity_provider_identity")," - The IdP username of the currently authenticated user.")),(0,a.kt)("p",null,"These are values that survive the duration of a user login session, and can be used in token mappers. In order to add such a mapper in the admin UI, navigate to the client you are using, select the ",(0,a.kt)("strong",{parentName:"p"},"Client scopes")," tab, select the ",(0,a.kt)("inlineCode",{parentName:"p"},"{client}-dedicated")," scope link, select the ",(0,a.kt)("em",{parentName:"p"},"Mappers")," tab and configure a new mapper of type ",(0,a.kt)("inlineCode",{parentName:"p"},"User Session Notes"),". You can choose the ",(0,a.kt)("em",{parentName:"p"},"Token Claim Name")," that you require, and configure which tokens it is included."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Keycloak Phase Two Organizations Protocol Mapper",src:i(43261).Z,width:"1071",height:"705"})),(0,a.kt)("h3",{id:"handling-user-in-multiple-organization-each-with-a-specific-idp"},"Handling user in multiple organization, each with a specific IdP"),(0,a.kt)("p",null,"When using organization specific IdP and users are part of multiple organizations, it may lead to a situation where a user is authenticated against IdP ",(0,a.kt)("inlineCode",{parentName:"p"},"acme-corp-idp")," which is used by organization ",(0,a.kt)("inlineCode",{parentName:"p"},"acme-corp")," while accessing organization ",(0,a.kt)("inlineCode",{parentName:"p"},"beta-corp")," assets. In this case you might want to force the user to authenticate against ",(0,a.kt)("inlineCode",{parentName:"p"},"beta-corp-idp")," while remaining authenticated against ",(0,a.kt)("inlineCode",{parentName:"p"},"acme-corp-idp")," if they wish to switch back to ",(0,a.kt)("inlineCode",{parentName:"p"},"acme-corp")," assets."),(0,a.kt)("p",null,"This can be achieved by using ",(0,a.kt)("inlineCode",{parentName:"p"},"prompt=login")," as the ",(0,a.kt)("inlineCode",{parentName:"p"},"idpHint")," to force the user to log into the ",(0,a.kt)("inlineCode",{parentName:"p"},"beta-corp-idp"),". This is described in more detail in the ",(0,a.kt)("a",{parentName:"p",href:"/docs/sso/sso-without-auth/#add-identity-provider-redirect-to-your-application"},"SSO documentation"),"."),(0,a.kt)("h3",{id:"api-access"},"API access"),(0,a.kt)("p",null,"It is possible to manage all aspects of the identity provider and its relationship to the organization using the ",(0,a.kt)("a",{parentName:"p",href:"/api/phase-two-admin-rest-api"},"API"),". You will notice that the method in the Phase Two API are similar to those in the Keycloak Admin API. If you are building software that is targeted at organization administrators, you should use the Phase Two API, as it uses the permission model for organizations, and is not compatible with the Keycloak Admin API."))}c.isMDXComponent=!0},25195:function(e,t,i){t.Z=i.p+"assets/images/organizations-idps-associate-34b362b34da370602821616212190f4e.png"},37575:function(e,t,i){t.Z=i.p+"assets/images/organizations-idps-domains-50d5467aee82ede5fd0b2c5ac268a66c.png"},43261:function(e,t,i){t.Z=i.p+"assets/images/organizations-idps-mapper-d5357da76f87e8323812114c7114f88c.png"}}]);