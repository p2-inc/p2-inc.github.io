"use strict";(globalThis.webpackChunkphasetwo_docs=globalThis.webpackChunkphasetwo_docs||[]).push([[67363],{49531(e,n,t){t.d(n,{R:()=>i,x:()=>r});var s=t(30758);const a={},o=s.createContext(a);function i(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(o.Provider,{value:n},e.children)}},81781(e){e.exports=JSON.parse('{"permalink":"/blog/user-events-in-keycloak","source":"@site/blog/2025-08-01-purging-user-events.md","title":"User Events in Keycloak: Best Practices, Management, and Purging","description":"Keycloak tracks various \\"user events\\" to provide auditing and monitoring capabilities related to user activities within a realm. These events capture actions performed by users, such as authentication attempts, account management operations, and more.","date":"2025-08-01T00:00:00.000Z","tags":[{"inline":true,"label":"phase_two","permalink":"/blog/tags/phase-two"},{"inline":true,"label":"keycloak","permalink":"/blog/tags/keycloak"},{"inline":true,"label":"user_events","permalink":"/blog/tags/user-events"},{"inline":true,"label":"admin_events","permalink":"/blog/tags/admin-events"},{"inline":true,"label":"database","permalink":"/blog/tags/database"},{"inline":true,"label":"performance","permalink":"/blog/tags/performance"}],"readingTime":5.75,"hasTruncateMarker":true,"authors":[{"name":"Phase Two","title":"Hosted Keycloak and Keycloak Support","url":"https://github.com/p2-inc","email":"support@phasetwo.io","imageURL":"https://avatars.githubusercontent.com/u/60152109?s=200&v=4","key":"phasetwo","page":null}],"frontMatter":{"title":"User Events in Keycloak: Best Practices, Management, and Purging","slug":"user-events-in-keycloak","date":"2025-08-01T00:00:00.000Z","authors":"phasetwo","tags":["phase_two","keycloak","user_events","admin_events","database","performance"]},"unlisted":false,"prevItem":{"title":"Phase Two Recognized as Official CockroachDB Partner","permalink":"/blog/phasetwo-cockroachdb-partnership"},"nextItem":{"title":"Phase Two Launches New Dashboard for Keycloak Resource Management","permalink":"/blog/dashboard-launch"}}')},93797(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var s=t(81781),a=t(86070),o=t(49531);const i={title:"User Events in Keycloak: Best Practices, Management, and Purging",slug:"user-events-in-keycloak",date:new Date("2025-08-01T00:00:00.000Z"),authors:"phasetwo",tags:["phase_two","keycloak","user_events","admin_events","database","performance"]},r=void 0,l={authorsImageUrls:[void 0]},c=[{value:"What are Keycloak User Events?",id:"what-are-keycloak-user-events",level:2},{value:"Why Track User Events?",id:"why-track-user-events",level:2},{value:"How Long Should User Events Be Retained?",id:"how-long-should-user-events-be-retained",level:2},{value:"How to Purge User Events",id:"how-to-purge-user-events",level:2},{value:"Considerations Before Purging User Events",id:"considerations-before-purging-user-events",level:2},{value:"Safe Steps to Purge User Events",id:"safe-steps-to-purge-user-events",level:2},{value:"Keep Event Lifetime Low, Send to a 3rd Party System",id:"keep-event-lifetime-low-send-to-a-3rd-party-system",level:2},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:'Keycloak tracks various "user events" to provide auditing and monitoring capabilities related to user activities within a realm. These events capture actions performed by users, such as authentication attempts, account management operations, and more.'}),"\n",(0,a.jsx)(n.p,{children:"When these events have been tracked and not purged for a long period, for high traffic installations, trying to change the retention period can lead to a massive performance problem with your installation. We will walk you through what to consider and how to safely purge these events."}),"\n",(0,a.jsx)(n.h2,{id:"what-are-keycloak-user-events",children:"What are Keycloak User Events?"}),"\n",(0,a.jsx)(n.p,{children:"Keycloak user events are records of significant actions taken by users within a realm. These events can include (but are not limited to):"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Login attempts"}),": Successful and failed login attempts."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Account management"}),": Actions like password changes, profile updates, and account deletions."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Session management"}),": Events related to session creation, termination, and expiration. Including token refreshes."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["For more about event metric observability, see the ",(0,a.jsx)(n.a,{href:"https://www.keycloak.org/docs/latest/server_admin/#configuring-auditing-to-track-events",children:"Keycloak documentation on events"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Also, we're speaking about user events, but admin events are also tracked in Keycloak. These are actions taken by administrators, such as creating or deleting users, managing roles, and configuring realms. Similar principles apply to admin events."}),"\n",(0,a.jsx)(n.h2,{id:"why-track-user-events",children:"Why Track User Events?"}),"\n",(0,a.jsx)(n.p,{children:"Tracking user events can be useful for several reasons:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Monitoring"}),": Understanding user behavior and system performance by tracking number of logins, failed attempts, token refreshes, etc."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Exporting"}),": Exporting user events to external systems for further analysis or reporting. This can include creating dashboards or alerts based on user activity."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Auditing"}),": Maintaining a record of user actions for compliance and security purposes."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"One item of note, if you are running a Keycloak cluster, user events need to be collected from all instances to get a per cluster view."}),"\n",(0,a.jsx)(n.h2,{id:"how-long-should-user-events-be-retained",children:"How Long Should User Events Be Retained?"}),"\n",(0,a.jsxs)(n.p,{children:["The configuration for user event retention is set in the Keycloak admin console under the ",(0,a.jsx)(n.code,{children:"Realm Settings > Events > User events settings"}),'. Make sure that "Save events" is toggled to "On" and then in the expiration section, you can set the retention period for user events.']}),"\n",(0,a.jsx)(n.p,{children:"We recommend setting a reasonable retention period based on your application's needs. For example, you might choose to retain user events for 30 days, 90 days, or longer, depending on your compliance requirements and the volume of user activity. If you have a lot of user activity, you may want to set a shorter retention period to avoid performance issues."}),"\n",(0,a.jsx)(n.p,{children:"Keycloak will save these events in the database, and if you have a high volume of user activity, this can lead to a large number of records over time. This can impact the performance of your Keycloak instance, especially when querying or managing these events. Exporting events on a periodic basis to back up or use in external systems not only helps with performance but also allows you to keep a historical record of user activity."}),"\n",(0,a.jsx)(n.h2,{id:"how-to-purge-user-events",children:"How to Purge User Events"}),"\n",(0,a.jsx)(n.p,{children:"There are two ways to purge user events in Keycloak in the Admin UI:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:'Hit a big red button in the admin console that says "Clear user events".'}),"\n",(0,a.jsx)(n.li,{children:"Change the retention period to a shorter time frame, which will automatically purge events older than the new retention period."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"The thing is, those options are much to easy to hit and lead to unintended consequences. Clicking a button or changing a setting can lead to a large number of events being purged at once, which can cause performance issues or even downtime in your Keycloak instance. This effectively locks up the database and can lead to massive latency issues for you and your users."}),"\n",(0,a.jsx)(n.h2,{id:"considerations-before-purging-user-events",children:"Considerations Before Purging User Events"}),"\n",(0,a.jsx)(n.p,{children:"Before purging user events, consider the following:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"How many events are currently stored?"})," If you have a large number of events, purging them can take some time and may impact performance during the operation."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"What is the current retention period?"})," If you have a long retention period set, you may want to consider shortening it before purging to avoid performance issues in the future."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"What is the impact on auditing and monitoring?"})," Purging user events will remove historical data, so consider how this will affect your ability to monitor user activity and maintain compliance."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Backup your data"}),": If you need to keep a record of user events for compliance or auditing purposes, consider exporting the events to an external system before purging them. This way, you can retain a historical record of user activity without impacting the performance of your Keycloak instance."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:'With that in mind, the Admin UI provides some really safe and unguarded ways to just "push a button" and introduce almost immediate performance issues.'}),"\n",(0,a.jsx)(n.p,{children:"So what should you do?"}),"\n",(0,a.jsx)(n.h2,{id:"safe-steps-to-purge-user-events",children:"Safe Steps to Purge User Events"}),"\n",(0,a.jsx)(n.p,{children:"If you have a large number of user events and need to purge them safely, the only real way to do this is to create a manual script that will purge the events in small batches. This way, you can avoid locking up the database and causing performance issues."}),"\n",(0,a.jsx)(n.p,{children:"Another option is to slowly pull in the retention period over time. For example, if you have a retention period of 365 days, you can change it to 180 days and then wait a few days before changing it to 90 days. This will allow Keycloak to purge events in smaller batches and hopefully avoid performance issues."}),"\n",(0,a.jsxs)(n.p,{children:["In addition, to avoid Admin UI click-ops oopsies, ensure that users with access to the Admin UI do not have permissions to ",(0,a.jsx)(n.code,{children:"manage-events"}),". This will prevent them from accidentally purging user events through the UI."]}),"\n",(0,a.jsx)(n.h2,{id:"keep-event-lifetime-low-send-to-a-3rd-party-system",children:"Keep Event Lifetime Low, Send to a 3rd Party System"}),"\n",(0,a.jsx)(n.p,{children:"One other option to consider is to keep the event lifetime low and send the events to a third-party system for long-term storage and analysis. This can be done by configuring Keycloak to export user events to an external system, such as a logging service or a data warehouse. Doing the actual configuration though, is not native to Keycloak and requires an extension."}),"\n",(0,a.jsxs)(n.p,{children:["Using the Phase Two ",(0,a.jsx)(n.a,{href:"https://github.com/p2-inc/keycloak-events",children:"Events Extension"}),", this can be accomplished rather easily. By adding configuration to the ",(0,a.jsx)(n.code,{children:"EventListenerProvider"})," it is possible to send the events to a specified URI (and optionally sign with keyed-HMAC). The extension provides a handful of options including webhooks and retry logic with exponential backoff."]}),"\n",(0,a.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,a.jsx)(n.p,{children:"Purging user events in Keycloak is an important task to maintain performance and manageability, especially for high-traffic installations. By understanding the implications of user event retention and following safe practices for purging, you can ensure that your Keycloak instance remains responsive and efficient."}),"\n",(0,a.jsxs)(n.p,{children:["If you have any questions or need assistance with purging user events, feel free to reach out to the Phase Two support team at ",(0,a.jsx)(n.a,{href:"mailto:support@phasetwo.io",children:"support@phasetwo.io"}),". We\u2019re here to help you manage your Keycloak resources effectively and ensure your deployment runs smoothly."]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);