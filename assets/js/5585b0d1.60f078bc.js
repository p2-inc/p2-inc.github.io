"use strict";(self.webpackChunkphasetwo_docs=self.webpackChunkphasetwo_docs||[]).push([[80603],{8732:e=>{e.exports=JSON.parse('{"permalink":"/blog/multi-tenancy-with-keycloak-organizations","source":"@site/blog/2024-11-11-multi-tenancy-with-organizations.md","title":"Implement Multi-Tenancy Applications with Keycloak Organizations","description":"Applications needing to leverage Keycloak to consolidate logins can leverage Keycloak Organizations.","date":"2024-11-11T00:00:00.000Z","tags":[{"inline":true,"label":"keycloak","permalink":"/blog/tags/keycloak"},{"inline":true,"label":"phase_two","permalink":"/blog/tags/phase-two"},{"inline":true,"label":"organizations","permalink":"/blog/tags/organizations"},{"inline":true,"label":"multitenant","permalink":"/blog/tags/multitenant"}],"readingTime":5.52,"hasTruncateMarker":true,"authors":[{"name":"Phase Two","title":"Hosted Keycloak and Keycloak Support","url":"https://github.com/p2-inc","email":"support@phasetwo.io","imageURL":"https://avatars.githubusercontent.com/u/60152109?s=200&v=4","key":"phasetwo","page":null}],"frontMatter":{"slug":"multi-tenancy-with-keycloak-organizations","title":"Implement Multi-Tenancy Applications with Keycloak Organizations","description":"Applications needing to leverage Keycloak to consolidate logins can leverage Keycloak Organizations.","authors":"phasetwo","tags":["keycloak","phase_two","organizations","multitenant"]},"unlisted":false,"prevItem":{"title":"Why your startup should use Keycloak for SSO and User Management - Part 4: Cost","permalink":"/blog/keycloak-for-startups-cost"},"nextItem":{"title":"Why your startup should use Keycloak for SSO and User Management - Part 3: Customization","permalink":"/blog/keycloak-for-startups-customization"}}')},28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>l});var a=i(96540);const t={},o=a.createContext(t);function s(e){const n=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),a.createElement(o.Provider,{value:n},e.children)}},32006:(e,n,i)=>{i.d(n,{A:()=>a});const a=i.p+"assets/images/system-77f0bb306b484ef7aa0635f2b8952455.png"},44857:(e,n,i)=>{i.d(n,{A:()=>a});const a=i.p+"assets/images/user-access-f73e24ee7247a5d91563e808e0fbc5af.png"},60020:(e,n,i)=>{i.d(n,{A:()=>a});const a=i.p+"assets/images/orgs-39834411eecdd9d92991c919f3777a05.png"},92769:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var a=i(8732),t=i(74848),o=i(28453);const s={slug:"multi-tenancy-with-keycloak-organizations",title:"Implement Multi-Tenancy Applications with Keycloak Organizations",description:"Applications needing to leverage Keycloak to consolidate logins can leverage Keycloak Organizations.",authors:"phasetwo",tags:["keycloak","phase_two","organizations","multitenant"]},l=void 0,r={authorsImageUrls:[void 0]},c=[{value:"Overview",id:"overview",level:3},{value:"Why use Organizations Instead of Multiple Realms?",id:"why-use-organizations-instead-of-multiple-realms",level:3},{value:"Conceptualizing Multi-Tenant Implementation",id:"conceptualizing-multi-tenant-implementation",level:3},{value:"Sample Implementation",id:"sample-implementation",level:3},{value:"Keycloak Configuration",id:"keycloak-configuration",level:4},{value:"Configuring Keycloak",id:"configuring-keycloak",level:5},{value:"Configuring Client Applications",id:"configuring-client-applications",level:5},{value:"In Conclusion",id:"in-conclusion",level:3}];function h(e){const n={a:"a",code:"code",em:"em",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h3,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"A multi-tenant application is a software architecture where a single instance of an application serves multiple, distinct customer groups or \u201ctenants.\u201d Each tenant, often representing an organization or user group, shares the same underlying infrastructure and codebase but operates within its own securely isolated environment. This allows each tenant to have individualized data, configurations, and sometimes even unique customizations, while benefiting from a shared platform that reduces overall resource demands and maintenance. Multi-tenancy is commonly used in SaaS (Software as a Service) applications, enabling businesses to scale efficiently, lower costs, and streamline updates while ensuring that each tenant\u2019s data and settings remain private and distinct from others within the same application. This approach is particularly valuable in enterprise applications, where companies may need to provide access to different organizations, departments, or customer groups within a single solution."}),"\n",(0,t.jsx)(n.p,{children:"This post will cover a few things:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Concept of how to implement this with Keycloak and Phase Two's ",(0,t.jsx)(n.a,{href:"https://phasetwo.io/product/organizations/",children:"Organization"})," extension (",(0,t.jsx)(n.a,{href:"https://github.com/p2-inc/keycloak-orgs",children:"Github"}),")."]}),"\n",(0,t.jsx)(n.li,{children:"Proof-of-concept implementation that will include how to configure a Keycloak instance with clients, organizations, roles, and example applications to consume these implementations."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["We have also given a detailed talk at Keycloak Dev Day on ",(0,t.jsx)(n.a,{href:"/blog/keycloak-orgs-presentation",children:"Multi-Tenancy within a Single Realm"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["The implementation, while not difficult, does require knowledge of how to use Keycloak. If you're unclear at any point, please reach out ",(0,t.jsx)(n.a,{href:"mailto:sales@phasetwo.io",children:"sales@phasetwo.io"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"why-use-organizations-instead-of-multiple-realms",children:"Why use Organizations Instead of Multiple Realms?"}),"\n",(0,t.jsxs)(n.p,{children:["Using Phase Two\u2019s Keycloak Extension for ",(0,t.jsx)(n.a,{href:"https://phasetwo.io/product/organizations/",children:"Organizations"})," provides a more efficient and scalable way to implement multi-tenancy than managing multiple realms in Keycloak. Here\u2019s why:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Resource Efficiency: Each realm in Keycloak creates isolated resources, which can lead to increased memory and CPU usage as the number of realms grows. By using a single realm with organizational support, you can maintain performance while still supporting multiple tenants."}),"\n",(0,t.jsx)(n.li,{children:"Centralized Management: Managing numerous realms can become complex, especially for shared configurations and customizations. The extension allows you to manage users, roles, and configurations within a single realm, reducing overhead."}),"\n",(0,t.jsx)(n.li,{children:"Simplified User Access Control: With organizations, you can easily segment users by tenant within the same realm. This allows for straightforward user and role management without needing to duplicate settings across realms."}),"\n",(0,t.jsx)(n.li,{children:"Improved Scalability: As your application scales, the single-realm approach with organizational structures is more sustainable, reducing maintenance and potential errors. It supports a logical separation for tenants without the performance and management limitations of numerous realms."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Overall, the extension simplifies and optimizes Keycloak for multi-tenant applications, focusing on efficient resource usage and management scalability."}),"\n",(0,t.jsx)(n.h3,{id:"conceptualizing-multi-tenant-implementation",children:"Conceptualizing Multi-Tenant Implementation"}),"\n",(0,t.jsx)(n.p,{children:"We're going to use the following example system:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"2 applications"}),"\n",(0,t.jsx)(n.li,{children:"2 tenants of each applications"}),"\n",(0,t.jsx)(n.li,{children:"Single Keycloak realm"}),"\n",(0,t.jsx)(n.li,{children:"Two Keycloak Organizations to represent the tenants"}),"\n",(0,t.jsx)(n.li,{children:"Role names that match the applications"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"We can visualize this in the following diagram:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"System",src:i(32006).A+"",width:"2354",height:"1601"})}),"\n",(0,t.jsx)(n.p,{children:"In Keycloak, we match the system implementation by doing the following:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Two Clients match the two Applications. More Clients added per tenant."}),"\n",(0,t.jsx)(n.li,{children:"Two Organizations match the two Tenants. This could be scaled out for additional tenants."}),"\n",(0,t.jsx)(n.li,{children:"One role per Tenant within each Organization."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"If we break this down specifically with the names:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"Application system"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Two applications: Zoo, Aquarium"}),"\n",(0,t.jsx)(n.li,{children:"Two tenants: California, New York"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"Keycloak system"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Two clients: Zoo, Aquarium"}),"\n",(0,t.jsx)(n.li,{children:"Two organizations: California, New York"}),"\n",(0,t.jsx)(n.li,{children:"Two roles per for Org: zoo, aquarium"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"In order for users to then have access to the various Clients and Tenants, we would add them as members to the Organization, then assign them roles that match their access."}),"\n",(0,t.jsx)(n.p,{children:"We can visualize this as follows:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"User Access",src:i(44857).A+"",width:"1681",height:"1138"})}),"\n",(0,t.jsx)(n.p,{children:"This represents following access:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["User 1","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Zoo application, California tenant"}),"\n",(0,t.jsx)(n.li,{children:"Aquarium application, California tenant"}),"\n",(0,t.jsx)(n.li,{children:"Aquarium application, New York tenant"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["User 2","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Zoo application, California tenant"}),"\n",(0,t.jsx)(n.li,{children:"Zoo application, New York tenant"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Users are granted roles to represent application access. Users are made members of an Organization to represent tenant access."}),"\n",(0,t.jsxs)(n.p,{children:["Consuming and implementing this representation can be done via the Organizations API on the ",(0,t.jsxs)(n.a,{href:"https://phasetwo.io/api/get-me/",children:[(0,t.jsx)(n.code,{children:"/me"})," endpoint"]}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"sample-implementation",children:"Sample Implementation"}),"\n",(0,t.jsx)(n.p,{children:"Now that we've discussed how the system is designed, let's work through an example of this application."}),"\n",(0,t.jsx)(n.h4,{id:"keycloak-configuration",children:"Keycloak Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["We'll be using Phase Two's ",(0,t.jsx)(n.a,{href:"/hosting",children:"free hosted Keycloak"})," to set up a deployment and associated organizations. Visit ",(0,t.jsx)(n.a,{href:"https://dash.phasetwo.io/",children:"Phase Two Dashboard"}),' to sign up for a free account and create a deployment. After you have created the deployment, click the "Open Console" link to go to the Keycloak deployment.']}),"\n",(0,t.jsx)(n.p,{children:"Next we'll configure Keycloak and then configure the applications."}),"\n",(0,t.jsx)(n.h5,{id:"configuring-keycloak",children:"Configuring Keycloak"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Go to the Clients tab. We will create two Clients. Provide a ",(0,t.jsx)(n.code,{children:"Client ID"})," of ",(0,t.jsx)(n.code,{children:"aquarium"})," and ",(0,t.jsx)(n.code,{children:"zoo"})," to each. Enter a value of ",(0,t.jsx)(n.code,{children:"*"})," for ",(0,t.jsx)(n.code,{children:"Valid redirect URIs"})," (don't use this for production)."]}),"\n",(0,t.jsxs)(n.li,{children:["Go to the Users tab. Add a user with a username of ",(0,t.jsx)(n.code,{children:"jane"}),", first name of ",(0,t.jsx)(n.code,{children:"jane"}),", and last name of ",(0,t.jsx)(n.code,{children:"goodall"}),". Add a second user with a username of ",(0,t.jsx)(n.code,{children:"jacques"}),", first name of ",(0,t.jsx)(n.code,{children:"jacques"}),", and last name of ",(0,t.jsx)(n.code,{children:"cousteau"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Go to the Organizations tab. Create two Organizations. Name one ",(0,t.jsx)(n.code,{children:"california"})," and the other ",(0,t.jsx)(n.code,{children:"new york"}),". For each organization, create two roles: ",(0,t.jsx)(n.code,{children:"aquarium"})," and ",(0,t.jsx)(n.code,{children:"zoo"}),". For each organization, add the two user's created to them as members."]}),"\n",(0,t.jsxs)(n.li,{children:["Inside the ",(0,t.jsx)(n.code,{children:"california"})," organization, assign the ",(0,t.jsx)(n.code,{children:"aquarium"})," role to the ",(0,t.jsx)(n.code,{children:"jacques"})," user. Assign the ",(0,t.jsx)(n.code,{children:"zoo"})," role to the ",(0,t.jsx)(n.code,{children:"jane"})," user."]}),"\n",(0,t.jsxs)(n.li,{children:["Inside the ",(0,t.jsx)(n.code,{children:"newyork"})," organization, assign the ",(0,t.jsx)(n.code,{children:"aquarium"})," role to both users. Assign the ",(0,t.jsx)(n.code,{children:"zoo"})," role only to the ",(0,t.jsx)(n.code,{children:"jane"})," user."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"At this point we should have all we require for configuring our client applications as needed."}),"\n",(0,t.jsx)(n.h5,{id:"configuring-client-applications",children:"Configuring Client Applications"}),"\n",(0,t.jsxs)(n.p,{children:["We won't go through all the steps required to build a client application in this post. We have a ",(0,t.jsx)(n.code,{children:"nx"})," ",(0,t.jsx)(n.a,{href:"https://github.com/p2-inc/examples/tree/main/multitenant",children:"monorepo"})," generated for use where you can clone it and change the OIDC client config to speak to the correct applications."]}),"\n",(0,t.jsxs)(n.p,{children:["Update the associated values make use of the Keycloak configuration you created above: realm name, clients, and so on. The app is setup already with a scaffold to pull the ",(0,t.jsx)(n.code,{children:"/orgs/me"})," endpoint."]}),"\n",(0,t.jsxs)(n.p,{children:["Once you have the application setup (check readme for more details), log in as the ",(0,t.jsx)(n.code,{children:"jane"})," and ",(0,t.jsx)(n.code,{children:"jacques"})," user to see the variation of which organization and roles they have access to. You'll see a variation of this:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Organizations",src:i(60020).A+"",width:"1100",height:"796"})}),"\n",(0,t.jsx)(n.h3,{id:"in-conclusion",children:"In Conclusion"}),"\n",(0,t.jsxs)(n.p,{children:["Creating a multi-tenant application isn't necessarily easy, but it is well within the capability of Keycloak. If you end up leveraging our Organization's extension to support multi-tenancy, let us ",(0,t.jsx)(n.a,{href:"mailto:sales@phasetwo.io",children:"know"}),"."]})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}}}]);