<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">3 posts tagged with &quot;reactjs&quot; | Phase Two enhanced Keycloak as a Service</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://phasetwo.io/blog/tags/reactjs/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="keycloak, iam, sso"><meta data-rh="true" name="description" content="Tools for SaaS builders - Enhanced Keycloak as a Service"><meta data-rh="true" property="og:logo" content="/img/appstore.png" size="1024x1024"><meta data-rh="true" property="og:image" content="/img/appstore.png" size="1024x1024"><meta data-rh="true" property="og:logo" content="/img/playstore.png" size="512x512"><meta data-rh="true" property="og:title" content="3 posts tagged with &quot;reactjs&quot; | Phase Two enhanced Keycloak as a Service"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://phasetwo.io/blog/tags/reactjs/"><link data-rh="true" rel="alternate" href="https://phasetwo.io/blog/tags/reactjs/" hreflang="en"><link data-rh="true" rel="alternate" href="https://phasetwo.io/blog/tags/reactjs/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://W4PN7W5A70-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Phase Two enhanced Keycloak as a Service RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Phase Two enhanced Keycloak as a Service Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-160183620-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-160183620-1",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Phase Two enhanced Keycloak as a Service" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.72c9e936.css">
<link rel="preload" href="/assets/js/runtime~main.670949fd.js" as="script">
<link rel="preload" href="/assets/js/main.9e36dd42.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#3fa1e3;color:#fff" role="banner"><div class="content_knG7 announcementBarContent_xLdY"><a href="/blog/dedicated-launch">Announcing Dedicated Clusters!</a> Isolated compute, network and storage for your Phase Two Keycloak cluster.</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_phase_slash.svg" alt="Phase Two" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_phase_slash.svg" alt="Phase Two" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Product</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/product/sso/">SSO</a></li><li><a class="dropdown__link" href="/product/identity/">Identity</a></li><li><a class="dropdown__link" href="/product/organizations/">Organizations</a></li><li><a class="dropdown__link" href="/product/adminportal/">Admin Portal</a></li><li><a class="dropdown__link" href="/product/onprem/">On-Prem Deployment</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Developers</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/introduction/">Docs</a></li><li><a class="dropdown__link" href="/api/phase-two-admin-rest-api/">API</a></li><li><a href="https://github.com/p2-inc/" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub</a></li></ul></div><a class="navbar__item navbar__link" href="/#pricing">Pricing</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://phasetwo.io/dashboard/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" buttontype="btnSecondary">Dashboard<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://phasetwo.io/dashboard/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" buttontype="btnPrimary">Get Started<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">News</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/instant-user-management-and-sso-for-remix/">Securing Remix Apps with Keycloak</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/keycloak-orgs-presentation/">Presentation on Multi-Tenancy in Keycloak</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/customizing-email-templates/">How to Customize Email Templates in Keycloak</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/identity-brokering-on-prem/">User Management and Identity Brokering for On-Prem Apps</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/open-source-iam/">Keycloak: An open source alternative to Auth0, WorkOS, Okta, Cognito, ...</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/keycloak-on-cockroachdb/">Keycloak on CockroachDB: Scalable, Resilient, Open Source, Identity and Access Management</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/instant-user-managemenet-and-sso-for-vue/">Securing Vue Apps with Keycloak</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/instant-user-managemenet-and-sso-for-nuxt/">Securing Nuxt Apps with Keycloak</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/secure-django/">Django Web Authentication with Keycloak</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/instant-user-managemenet-and-sso-for-nextjs/">Securing Next.js Apps with Keycloak</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/instant-user-managemenet-and-sso-for-reactjs/">Instant User Management, SSO, and Secure Pages for ReactJS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/dedicated-launch/">Launching Dedicated Clusters</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/customizing-login-pages/">How To Customize Login Pages</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/licensing-change/">We&#x27;re Changing Our License</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/sso-setup/">Setting up SSO with Phase Two</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/securing-apps-with-keycloak/">Protecting Your Application With Keycloak</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/set-up-magic-links/">Magic Links Guide, and 5 Minute Setup</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/set-up-email/">Set Up Email in Phase Two</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/self-service/">Self-service (beta) Launch</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/magic-link/">Magic Links</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/orgs/">Multi-tenant Extensions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/connect/">Introducing Phase Two Connect</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/wizard/">SSO? Wave Your Magic Wand</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/events/">Events and Audit Logging Extensions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/free-realm/">Free as in Beer</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/keycloak/">Keycloak, and Our Commitment to Open Source</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/welcome/">Welcome to Phase Two</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>3 posts tagged with &quot;reactjs&quot;</h1><a href="/blog/tags/">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/instant-user-management-and-sso-for-remix/">Securing Remix Apps with Keycloak</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-04-24T00:00:00.000Z" itemprop="datePublished">April 24, 2024</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Phase Two</span></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>In this article we&#x27;ll be using <a href="https://www.keycloak.org/" target="_blank" rel="noopener noreferrer">Keycloak</a> to quickly augment an application with user management and SSO. We will demonstrate the integration by securing a page for logged-in users. This quickly provides a jump-off point to more complex integrations.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>If you just want to skip to the code, visit the Phase Two <a href="https://github.com/p2-inc/examples/tree/main/frameworks/remix" target="_blank" rel="noopener noreferrer">Remix example</a>. We also have a plain <a href="https://phasetwo.io/blog/instant-user-managemenet-and-sso-for-reactjs" target="_blank" rel="noopener noreferrer">React example</a>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-a-keycloak-instance">Setting up a Keycloak Instance<a class="hash-link" href="#setting-up-a-keycloak-instance" title="Direct link to heading">​</a></h2><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Instructions</summary><div><div class="collapsibleContent_i85q"><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>If you already have a functioning Keycloak instance, you can skip to the next section.</p></div></div><p>Rather than trying to set up a &quot;from scratch&quot; instance of Keycloak, we&#x27;re going to short-circuit that process by leveraging a free <a href="https://phasetwo.io/" target="_blank" rel="noopener noreferrer">Phase Two Starter</a> instance. The Starter provides a free hosted instance of Phase Two&#x27;s enhanced Keycloak ready for light production use cases.</p><ul><li><p>Visit the sign-up <a href="https://phasetwo.io/dashboard/" target="_blank" rel="noopener noreferrer">page</a>.</p></li><li><p>Enter an email, use a Github account, or use an existing Google account to register.</p><p><img loading="lazy" alt="Phase Two Register" src="/assets/images/register-c45850867ce85096a398bb0dfab9df4d.png" width="3000" height="1763" class="img_ev3q"></p></li><li><p>Follow the register steps. This will include a sign-in link being sent to your email. Use that for password-less login.</p><p><img loading="lazy" alt="Phase Two Email Magic Link Register" src="/assets/images/email_link-cefd0e50772e855bbaa5de46bda7f504.png" width="3000" height="857" class="img_ev3q"></p></li><li><p>After creating an account, a <a href="https://www.youtube.com/watch?v=ZTFlc-3pG1M" target="_blank" rel="noopener noreferrer">realm</a> is automatically created for you with all of the Phase Two enhancements. You need to create a Deployment in the Shared Phase Two infrastructure in order to gain access to the realm. Without a deployment created, the Create Shared Deployment modal will automatically pop up.</p></li><li><p>Create a Shared Deployment by providing a region (pick something close to your existing infrastructure), a name for the deployment, and selecting the default organization that was created for you upon account creation. Hit &quot;Confirm&quot; when ready. Standby while our robots get to work generating your deployment. This can take a few seconds.</p><p><img loading="lazy" alt="Phase Two Create Shared Deployment" src="/assets/images/create_shared_deployment-a4fc0584f6318f037cf191e06c9703b8.png" width="3000" height="1541" class="img_ev3q"></p></li><li><p>After the deployment is created and active, you can access the Keycloak Admin console by clicking &quot;Open Console&quot; for that deployment. Open it now to see the console.</p><p><img loading="lazy" alt="Phase Two Open Console Keycloak Admin UI" src="/assets/images/deployments-e5cb24a81b832bb19e3adf754c133bf1.png" width="3000" height="1311" class="img_ev3q"></p></li></ul><p>At this point, move on to the next step in the tutorial. We&#x27;ll be coming back to the Admin Console when its time to start connecting our App to the Keycloak instance.</p></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-an-oidc-client">Setting up an OIDC Client<a class="hash-link" href="#setting-up-an-oidc-client" title="Direct link to heading">​</a></h2><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Instructions</summary><div><div class="collapsibleContent_i85q"><p>We need to create a <a href="https://www.keycloak.org/docs/latest/server_admin/#con-oidc_server_administration_guide" target="_blank" rel="noopener noreferrer">OpenID Connect</a> Client in Keycloak for the app to communicate with. Keycloak&#x27;s <a href="https://www.keycloak.org/docs/latest/server_admin/#_oidc_clients" target="_blank" rel="noopener noreferrer">docs</a> provide steps for how to create an OIDC client and all the various configurations that can be introduced. Follow the steps below to create a client and get the right information necessary for app configuration.</p><ol><li><p>Open the Admin UI by clicking <strong>Open Console</strong> in the Phase Two Dashboard.</p></li><li><p>Click <strong>Clients</strong> in the menu.</p></li><li><p>Click <strong>Create client</strong>.</p></li><li><p>Leave <strong>Client type</strong> set to <strong>OpenID Connect</strong>.</p></li><li><p>Enter a <strong>Client ID</strong>. This ID is an alphanumeric string that is used in OIDC requests and in the Keycloak database to identify the client.</p></li><li><p>Supply a <strong>Name</strong> for the client.</p></li><li><p>Click <strong>Next</strong>.</p><p><img loading="lazy" alt="Keycloak OIDC Create Client General Settings" src="/assets/images/general-settings-0a3265fecd73272214fb1d3d9c4a57a7.png" width="3000" height="2072" class="img_ev3q"></p></li><li><p>Under the Capability Config section, leave the defaults as selected. This can be configured further later.</p><ul><li>Client authentication to On.</li><li>Authorization to Off.</li><li>Standard flow checked. Direct access grants checked. All other items unchecked.</li></ul></li><li><p>Click <strong>Next</strong>.</p><p><img loading="lazy" alt="Keycloak OIDC Create Client Capability Config with Authentication" src="/assets/images/capability-config-with-auth-cdb9c0e4d816fd1b345a2b4f0ad31fea.png" width="3000" height="1909" class="img_ev3q"></p></li><li><p>Under Login settings we need to add a redirect URI and Web origin in order. Assuming you are using the example applicaiton:</p><p><em>Valid redirect URI</em> (allows redirect back to application)</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">http://localhost:3000/*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>Web origins</em> (allows for Token auth call)</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">http://localhost:3000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>URI and Origin Details</summary><div><div class="collapsibleContent_i85q"><p>The choice of <code>localhost</code> is arbitrary. If you are using an example application running locally, this will apply. If you are using an app that you actually have deployed somewhere, then you will need to substitute the appropriate URI for that.</p></div></div></details></li><li><p>Click <strong>Save</strong></p><p><img loading="lazy" alt="Keycloak OIDC Create Login Settings" src="/assets/images/login-settings-7706affb95f5f93f7490d7b46f9ec1f4.png" width="3000" height="2074" class="img_ev3q"></p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="oidc-config">OIDC Config<a class="hash-link" href="#oidc-config" title="Direct link to heading">​</a></h3><p>We will need values to configure our application. To get these values follow the instructions below.</p><ol><li><p>Click <strong>Clients</strong> in the menu.</p></li><li><p>Find the Client you just created and click on it. In the top right click the <strong>Action</strong> dropdown and select <strong>Download adapter config</strong>.</p></li><li><p>Select <strong>Keycloak OIDC JSON</strong> in the format option. The details section will populate with the details we will need.</p><ul><li>Note the <code>realm</code>, <code>auth-server-url</code>, and <code>resource</code> values.</li></ul><p><img loading="lazy" alt="Keycloak OIDC Create Client Adapter Config" src="/assets/images/adapter-config-c561561514672a51754146ff56e6bbe3.png" width="3000" height="2081" class="img_ev3q"></p></li><li><p>You also need to copy the <strong>Client secret</strong> in the <strong>Credential</strong> tab for the client to use. Once on the Credential tab, click the copy button to copy the key to your clipboard. Save the key somewhere for use later in this tutorial</p><p><img loading="lazy" alt="Keycloak OIDC Create Client Client Secret" src="/assets/images/copy-credential-c9822fe7c52d15c588ca6661aa2416fd.png" width="3492" height="2212" class="img_ev3q"></p></li></ol></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="adding-a-non-admin-user">Adding a Non-Admin User<a class="hash-link" href="#adding-a-non-admin-user" title="Direct link to heading">​</a></h2><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Instructions</summary><div><div class="collapsibleContent_i85q"><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>It is bad practice to use your Admin user to sign in to an Application.</p></div></div><p>Since we do not want to use our Admin user for signing into the app we will build, we need to add a another non-admin user.</p><ol><li>Open the Admin UI by clicking <strong>Open Console</strong> in the Phase Two Dashboard.</li><li>Click <strong>Users</strong> in the menu.</li><li>Click <strong>Add user</strong>.</li><li>Fill out the information for Email, First name, and Last name. Click <strong>Create</strong>.</li><li>We will now set the password for this user manually. Click <strong>Credentials</strong> (tab) and click <strong>Set Password</strong>. Provide a password for this user. For our use case, as a tutorial, you can leave &quot;Temporary&quot; set to &quot;Off&quot;.</li><li>Click <strong>Save</strong> and confirm the password by clicking <strong>Save password</strong></li></ol></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-a-remix-project">Setting up a Remix Project<a class="hash-link" href="#setting-up-a-remix-project" title="Direct link to heading">​</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>We will use the Phase Two Remix example code here, but the logic could easily be applied to any existing application.</p></div></div><ol><li>Clone the Phase Two <a href="https://github.com/p2-inc/examples/" target="_blank" rel="noopener noreferrer">example repo</a>.</li><li>Open the Remix <a href="https://github.com/p2-inc/examples/tree/main/frameworks/remix" target="_blank" rel="noopener noreferrer">folder</a> within <code>/frameworks/remix</code>.</li><li>Run <code>npm install</code> and then <code>npm run dev -- --port 3000</code>. This example leverages <a href="https://github.com/sergiodxa/remix-auth" target="_blank" rel="noopener noreferrer">remix-auth</a> and <a href="https://github.com/marsmars0x01/remix-keycloak" target="_blank" rel="noopener noreferrer">remix-keycloak</a> to provide HOC support.</li><li>Open the <code>app/services/keycloak.server.ts</code> file. This is a server only file. We will be updating a few values from the prior section where we set up our OIDC client. Taking the values from the OIDC Client Config section, set those values in the code. While it is recommended to use Environment variables for the secret, for the purpose of this tutorial, paste in the <strong>Client secret</strong> from the OIDC client creation section for the value of <code>clientSecret</code>:</li></ol><div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> kcConfig </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  useSSL</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  domain</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;usw2.auth.ac/auth&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  realm</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;shared-deployment-001&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  clientID</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;reg-example-1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  clientSecret</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;CLIENT_SECRET&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Paste &quot;Client secret&quot; here. Use Environment variables in prod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  callbackURL</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;http://localhost:3000/auth/keycloak/callback&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Those are used to popluate the config for the <code>KeycloakStrategy</code>:</p><div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">KeycloakStrategy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">kcConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> profile </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> profile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The config is then used with the Authenticator instance in the <code>app/services/auth.server.ts</code> file. The authenticator instance uses the Session Storage to manage the state of authentication via a cookie.</p><div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Authenticator</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;remix-auth&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports">keycloakServer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;./keycloak.server&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports dom variable" style="color:rgb(191, 199, 213)">sessionStorage</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;~/services/session.server&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> authenticator </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Authenticator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token dom variable" style="color:rgb(191, 199, 213)">sessionStorage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">authenticator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">use</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">keycloakServer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>At this point our entire application will be able to access all information and methods needed to perform authentication. View the <code>session.server.ts</code> file for additional information about how the <code>SessionStorage</code> is used. The <code>SessionStorage</code> stores the Keycloak token and is used to derive the authenticated state. View <code>user.tsx</code> for exactly how the code is authenticating your user. The sections rendering the <strong>Log in</strong> and <strong>Log out</strong> buttons are conditional areas based on the authenticated context. The buttons invoke server-side APIs provided by <code>remix-auth</code>.</p><p>The logic using the authenticator to conditionally determine the Authenticated state, can be used to secure routes, components, and more.</p><ol start="5"><li><p>Open <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">localhost:3000</a>. You will see the Phase Two example landing page. You current state should be <strong>Not authenticated</strong>. Click <strong>Log In</strong>. This will redirect you to your login page.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Use the non-admin user created in the previous section to sign in.</p></div></div></li><li><p>Enter the credentials of the non-admin user you created. Click <strong>Submit</strong>. You will then be redirected to the application. The Phase Two example landing page now loads your <strong>Authenticated</strong> state, displaying your user&#x27;s email and name.</p></li><li><p>Neat! If you clear the browser state for that tab, then you will have to be redirected away to sign-in again.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="learning-more">Learning more<a class="hash-link" href="#learning-more" title="Direct link to heading">​</a></h2><p>Phase Two&#x27;s enhanced Keycloak provides many ways to quickly control and tweak the log in and user management experience. Our <a href="https://phasetwo.io/blog" target="_blank" rel="noopener noreferrer">blog</a> has many use cases from <a href="https://phasetwo.io/blog/customizing-login-pages" target="_blank" rel="noopener noreferrer">customizing login pages</a>, setting up <a href="https://phasetwo.io/blog/set-up-magic-links" target="_blank" rel="noopener noreferrer">magic links</a> (password-less sign in), and <a href="https://phasetwo.io/product/organizations" target="_blank" rel="noopener noreferrer">Organization</a> workflows.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/phase-two/">phase_two</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tutorial/">tutorial</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/frameworks/">frameworks</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/remix/">remix</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/react/">react</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/reactjs/">reactjs</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/authentication/">authentication</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/authorization/">authorization</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/sso/">sso</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/instant-user-managemenet-and-sso-for-nextjs/">Securing Next.js Apps with Keycloak</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-08-14T00:00:00.000Z" itemprop="datePublished">August 14, 2023</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Phase Two</span></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>In this article we&#x27;ll be using <a href="https://www.keycloak.org/" target="_blank" rel="noopener noreferrer">Keycloak</a> to quickly augment an application with user management and SSO. We will demonstrate the integration by securing a page for logged-in users. This quickly provides a jump-off point to more complex integrations.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>If you just want to skip to the code, visit the Phase Two <a href="https://github.com/p2-inc/examples/tree/main/frameworks/nextjs" target="_blank" rel="noopener noreferrer">Next.js example</a>. We also have a plain <a href="https://phasetwo.io/blog/instant-user-managemenet-and-sso-for-reactjs" target="_blank" rel="noopener noreferrer">React example</a>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-a-keycloak-instance">Setting up a Keycloak Instance<a class="hash-link" href="#setting-up-a-keycloak-instance" title="Direct link to heading">​</a></h2><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Instructions</summary><div><div class="collapsibleContent_i85q"><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>If you already have a functioning Keycloak instance, you can skip to the next section.</p></div></div><p>Rather than trying to set up a &quot;from scratch&quot; instance of Keycloak, we&#x27;re going to short-circuit that process by leveraging a free <a href="https://phasetwo.io/" target="_blank" rel="noopener noreferrer">Phase Two Starter</a> instance. The Starter provides a free hosted instance of Phase Two&#x27;s enhanced Keycloak ready for light production use cases.</p><ul><li><p>Visit the sign-up <a href="https://phasetwo.io/dashboard/" target="_blank" rel="noopener noreferrer">page</a>.</p></li><li><p>Enter an email, use a Github account, or use an existing Google account to register.</p><p><img loading="lazy" alt="Phase Two Register" src="/assets/images/register-c45850867ce85096a398bb0dfab9df4d.png" width="3000" height="1763" class="img_ev3q"></p></li><li><p>Follow the register steps. This will include a sign-in link being sent to your email. Use that for password-less login.</p><p><img loading="lazy" alt="Phase Two Email Magic Link Register" src="/assets/images/email_link-cefd0e50772e855bbaa5de46bda7f504.png" width="3000" height="857" class="img_ev3q"></p></li><li><p>After creating an account, a <a href="https://www.youtube.com/watch?v=ZTFlc-3pG1M" target="_blank" rel="noopener noreferrer">realm</a> is automatically created for you with all of the Phase Two enhancements. You need to create a Deployment in the Shared Phase Two infrastructure in order to gain access to the realm. Without a deployment created, the Create Shared Deployment modal will automatically pop up.</p></li><li><p>Create a Shared Deployment by providing a region (pick something close to your existing infrastructure), a name for the deployment, and selecting the default organization that was created for you upon account creation. Hit &quot;Confirm&quot; when ready. Standby while our robots get to work generating your deployment. This can take a few seconds.</p><p><img loading="lazy" alt="Phase Two Create Shared Deployment" src="/assets/images/create_shared_deployment-a4fc0584f6318f037cf191e06c9703b8.png" width="3000" height="1541" class="img_ev3q"></p></li><li><p>After the deployment is created and active, you can access the Keycloak Admin console by clicking &quot;Open Console&quot; for that deployment. Open it now to see the console.</p><p><img loading="lazy" alt="Phase Two Open Console Keycloak Admin UI" src="/assets/images/deployments-e5cb24a81b832bb19e3adf754c133bf1.png" width="3000" height="1311" class="img_ev3q"></p></li></ul><p>At this point, move on to the next step in the tutorial. We&#x27;ll be coming back to the Admin Console when its time to start connecting our App to the Keycloak instance.</p></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-an-oidc-client">Setting up an OIDC Client<a class="hash-link" href="#setting-up-an-oidc-client" title="Direct link to heading">​</a></h2><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Instructions</summary><div><div class="collapsibleContent_i85q"><p>We need to create a <a href="https://www.keycloak.org/docs/latest/server_admin/#con-oidc_server_administration_guide" target="_blank" rel="noopener noreferrer">OpenID Connect</a> Client in Keycloak for the app to communicate with. Keycloak&#x27;s <a href="https://www.keycloak.org/docs/latest/server_admin/#_oidc_clients" target="_blank" rel="noopener noreferrer">docs</a> provide steps for how to create an OIDC client and all the various configurations that can be introduced. Follow the steps below to create a client and get the right information necessary for app configuration.</p><ol><li><p>Open the Admin UI by clicking <strong>Open Console</strong> in the Phase Two Dashboard.</p></li><li><p>Click <strong>Clients</strong> in the menu.</p></li><li><p>Click <strong>Create client</strong>.</p></li><li><p>Leave <strong>Client type</strong> set to <strong>OpenID Connect</strong>.</p></li><li><p>Enter a <strong>Client ID</strong>. This ID is an alphanumeric string that is used in OIDC requests and in the Keycloak database to identify the client.</p></li><li><p>Supply a <strong>Name</strong> for the client.</p></li><li><p>Click <strong>Next</strong>.</p><p><img loading="lazy" alt="Keycloak OIDC Create Client General Settings" src="/assets/images/general-settings-0a3265fecd73272214fb1d3d9c4a57a7.png" width="3000" height="2072" class="img_ev3q"></p></li><li><p>Under the Capability Config section, leave the defaults as selected. This can be configured further later.</p><ul><li>Client authentication to On.</li><li>Authorization to Off.</li><li>Standard flow checked. Direct access grants checked. All other items unchecked.</li></ul></li><li><p>Click <strong>Next</strong>.</p><p><img loading="lazy" alt="Keycloak OIDC Create Client Capability Config with Authentication" src="/assets/images/capability-config-with-auth-cdb9c0e4d816fd1b345a2b4f0ad31fea.png" width="3000" height="1909" class="img_ev3q"></p></li><li><p>Under Login settings we need to add a redirect URI and Web origin in order. Assuming you are using the example applicaiton:</p><p><em>Valid redirect URI</em> (allows redirect back to application)</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">http://localhost:3000/*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>Web origins</em> (allows for Token auth call)</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">http://localhost:3000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>URI and Origin Details</summary><div><div class="collapsibleContent_i85q"><p>The choice of <code>localhost</code> is arbitrary. If you are using an example application running locally, this will apply. If you are using an app that you actually have deployed somewhere, then you will need to substitute the appropriate URI for that.</p></div></div></details></li><li><p>Click <strong>Save</strong></p><p><img loading="lazy" alt="Keycloak OIDC Create Login Settings" src="/assets/images/login-settings-7706affb95f5f93f7490d7b46f9ec1f4.png" width="3000" height="2074" class="img_ev3q"></p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="oidc-config">OIDC Config<a class="hash-link" href="#oidc-config" title="Direct link to heading">​</a></h3><p>We will need values to configure our application. To get these values follow the instructions below.</p><ol><li><p>Click <strong>Clients</strong> in the menu.</p></li><li><p>Find the Client you just created and click on it. In the top right click the <strong>Action</strong> dropdown and select <strong>Download adapter config</strong>.</p></li><li><p>Select <strong>Keycloak OIDC JSON</strong> in the format option. The details section will populate with the details we will need.</p><ul><li>Note the <code>realm</code>, <code>auth-server-url</code>, and <code>resource</code> values.</li></ul><p><img loading="lazy" alt="Keycloak OIDC Create Client Adapter Config" src="/assets/images/adapter-config-c561561514672a51754146ff56e6bbe3.png" width="3000" height="2081" class="img_ev3q"></p></li><li><p>You also need to copy the <strong>Client secret</strong> in the <strong>Credential</strong> tab for the client to use. Once on the Credential tab, click the copy button to copy the key to your clipboard. Save the key somewhere for use later in this tutorial</p><p><img loading="lazy" alt="Keycloak OIDC Create Client Client Secret" src="/assets/images/copy-credential-c9822fe7c52d15c588ca6661aa2416fd.png" width="3492" height="2212" class="img_ev3q"></p></li></ol></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="adding-a-non-admin-user">Adding a Non-Admin User<a class="hash-link" href="#adding-a-non-admin-user" title="Direct link to heading">​</a></h2><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Instructions</summary><div><div class="collapsibleContent_i85q"><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>It is bad practice to use your Admin user to sign in to an Application.</p></div></div><p>Since we do not want to use our Admin user for signing into the app we will build, we need to add a another non-admin user.</p><ol><li>Open the Admin UI by clicking <strong>Open Console</strong> in the Phase Two Dashboard.</li><li>Click <strong>Users</strong> in the menu.</li><li>Click <strong>Add user</strong>.</li><li>Fill out the information for Email, First name, and Last name. Click <strong>Create</strong>.</li><li>We will now set the password for this user manually. Click <strong>Credentials</strong> (tab) and click <strong>Set Password</strong>. Provide a password for this user. For our use case, as a tutorial, you can leave &quot;Temporary&quot; set to &quot;Off&quot;.</li><li>Click <strong>Save</strong> and confirm the password by clicking <strong>Save password</strong></li></ol></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-a-nextjs-project">Setting up a Next.js Project<a class="hash-link" href="#setting-up-a-nextjs-project" title="Direct link to heading">​</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>We will use the Phase Two Next.js example code here, but the logic could easily be applied to any existing application.</p></div></div><p>This example uses Next.js 13 and splits <code>server</code> and <code>client</code> components accordingly.</p><ol><li><p>Clone the Phase Two <a href="https://github.com/p2-inc/examples/" target="_blank" rel="noopener noreferrer">example repo</a>.</p></li><li><p>Open the Next.js <a href="https://github.com/p2-inc/examples/tree/main/frameworks/nextjs" target="_blank" rel="noopener noreferrer">folder</a> within <code>/frameworks/nextjs</code>.</p></li><li><p>Run <code>npm install</code> and then <code>npm run dev</code>. This example leverages <a href="https://next-auth.js.org/" target="_blank" rel="noopener noreferrer">NextAuth.js</a> to provide hook and HOC support.</p></li><li><p>NextAuth.js configures an API route that is uses for the Authentication of the Client. It generates the routes automatically for you. These are added to Next.js in the <code>api/auth/[...nextauth]/route.ts</code> file.</p></li><li><p>Open the <code>src/lib/auth.ts</code> file. This is a server only file. We will be updating a few values from the prior section where we set up our OIDC client. Taking the values from the OIDC Client Config section, set those values in the code. While it is recommended to use Environment variables for the secret, for the purpose of this tutorial, paste in the <strong>Client secret</strong> from the OIDC client creation section for the value of <code>clientSecret</code></p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> authServerUrl </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://euc1.auth.ac/auth/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> realm </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;shared-deployment-001&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> clientId </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;reg-example-1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> clientSecret </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;CLIENT_SECRET&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Paste &quot;Client secret&quot; here. Use Environment variables in prod</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Those are used to popluate the <code>AuthOptions</code> config for the <code>KeycloakProvider</code>:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword module" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token literal-property property">AuthOptions</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">NextAuthOptions</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">providers</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function maybe-class-name" style="color:rgb(130, 170, 255)">KeycloakProvider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      clientId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      clientSecret</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token literal-property property">issuer</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">authServerUrl</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string string" style="color:rgb(195, 232, 141)">realms/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">realm</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The config is then provided to the <code>AuthProvider</code> in the <code>/src/app/layout.tsx</code> file. Next.js uses this file to generate an HTML view for this page.</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword module" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">NextAuthProvider</span><span class="token imports"> </span><span class="token imports keyword module" style="font-style:italic">as</span><span class="token imports"> </span><span class="token imports maybe-class-name">AuthProvider</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword module" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;./providers&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">AuthProvider</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain">oidcConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">App</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token maybe-class-name">AuthProvider</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>At this point our entire application will be able to access all information and methods needed to perform authentication. View the <code>providers.tsx</code> file for additional information about how the <code>SessionProvider</code> is used. The <code>SessionProvider</code> enables use of Hooks to derive the authenticated state. View <code>user.component.tsx</code> for exactly how the code is authenticating your user. The sections rendering the &quot;Log in&quot; and &quot;Log out&quot; buttons are conditional areas based on the authenticated context. The buttons invoke functions provided by NextAuth.</p><p>The logic using the hook to conditionally determine the Authenticated state, can be used to secure routes, components, and more.</p></li><li><p>Open <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">localhost:3000</a>. You will see the Phase Two example landing page. You current state should be &quot;Not authenticated&quot;. Click <strong>Log In</strong>. This will redirect you to your login page.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Use the non-admin user created in the previous section to sign in.</p></div></div></li><li><p>Enter the credentials of the non-admin user you created. Click <strong>Submit</strong>. You will then be redirected to the application. The Phase Two example landing page now loads your &quot;Authenticated&quot; state, displaying your user&#x27;s email and their Token.</p></li><li><p>After your first log in, click <strong>Log out</strong>. Then click <strong>Log in</strong> again. Notice how this time you will not be redirected to sign in as your state is already in the browser. Neat! If you clear the browser state for that tab, then you will have to be redirected away to sign-in again.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="learning-more">Learning more<a class="hash-link" href="#learning-more" title="Direct link to heading">​</a></h2><p>Phase Two&#x27;s enhanced Keycloak provides many ways to quickly control and tweak the log in and user management experience. Our <a href="https://phasetwo.io/blog" target="_blank" rel="noopener noreferrer">blog</a> has many use cases from <a href="https://phasetwo.io/blog/customizing-login-pages" target="_blank" rel="noopener noreferrer">customizing login pages</a>, setting up <a href="https://phasetwo.io/blog/set-up-magic-links" target="_blank" rel="noopener noreferrer">magic links</a> (password-less sign in), and <a href="https://phasetwo.io/product/organizations" target="_blank" rel="noopener noreferrer">Organization</a> workflows.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/phase-two/">phase_two</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tutorial/">tutorial</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/frameworks/">frameworks</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/nextjs/">nextjs</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/react/">react</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/reactjs/">reactjs</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/authentication/">authentication</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/authorization/">authorization</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/sso/">sso</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/instant-user-managemenet-and-sso-for-reactjs/">Instant User Management, SSO, and Secure Pages for ReactJS</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-08-02T00:00:00.000Z" itemprop="datePublished">August 2, 2023</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Phase Two</span></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>In this article we&#x27;ll be using <a href="https://www.keycloak.org/" target="_blank" rel="noopener noreferrer">Keycloak</a> to quickly augment an application with user management and SSO. We will demonstrate the integration by securing a page for logged-in users. This quickly provides a jump-off point to more complex integrations.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>If you just want to skip to the code, visit the Phase Two <a href="https://github.com/p2-inc/examples/tree/main/frameworks/reactjs" target="_blank" rel="noopener noreferrer">ReactJS example</a>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-a-keycloak-instance">Setting up a Keycloak Instance<a class="hash-link" href="#setting-up-a-keycloak-instance" title="Direct link to heading">​</a></h2><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Instructions</summary><div><div class="collapsibleContent_i85q"><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>If you already have a functioning Keycloak instance, you can skip to the next section.</p></div></div><p>Rather than trying to set up a &quot;from scratch&quot; instance of Keycloak, we&#x27;re going to short-circuit that process by leveraging a free <a href="https://phasetwo.io/" target="_blank" rel="noopener noreferrer">Phase Two Starter</a> instance. The Starter provides a free hosted instance of Phase Two&#x27;s enhanced Keycloak ready for light production use cases.</p><ul><li><p>Visit the sign-up <a href="https://phasetwo.io/dashboard/" target="_blank" rel="noopener noreferrer">page</a>.</p></li><li><p>Enter an email, use a Github account, or use an existing Google account to register.</p><p><img loading="lazy" alt="Phase Two Register" src="/assets/images/register-c45850867ce85096a398bb0dfab9df4d.png" width="3000" height="1763" class="img_ev3q"></p></li><li><p>Follow the register steps. This will include a sign-in link being sent to your email. Use that for password-less login.</p><p><img loading="lazy" alt="Phase Two Email Magic Link Register" src="/assets/images/email_link-cefd0e50772e855bbaa5de46bda7f504.png" width="3000" height="857" class="img_ev3q"></p></li><li><p>After creating an account, a <a href="https://www.youtube.com/watch?v=ZTFlc-3pG1M" target="_blank" rel="noopener noreferrer">realm</a> is automatically created for you with all of the Phase Two enhancements. You need to create a Deployment in the Shared Phase Two infrastructure in order to gain access to the realm. Without a deployment created, the Create Shared Deployment modal will automatically pop up.</p></li><li><p>Create a Shared Deployment by providing a region (pick something close to your existing infrastructure), a name for the deployment, and selecting the default organization that was created for you upon account creation. Hit &quot;Confirm&quot; when ready. Standby while our robots get to work generating your deployment. This can take a few seconds.</p><p><img loading="lazy" alt="Phase Two Create Shared Deployment" src="/assets/images/create_shared_deployment-a4fc0584f6318f037cf191e06c9703b8.png" width="3000" height="1541" class="img_ev3q"></p></li><li><p>After the deployment is created and active, you can access the Keycloak Admin console by clicking &quot;Open Console&quot; for that deployment. Open it now to see the console.</p><p><img loading="lazy" alt="Phase Two Open Console Keycloak Admin UI" src="/assets/images/deployments-e5cb24a81b832bb19e3adf754c133bf1.png" width="3000" height="1311" class="img_ev3q"></p></li></ul><p>At this point, move on to the next step in the tutorial. We&#x27;ll be coming back to the Admin Console when its time to start connecting our App to the Keycloak instance.</p></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-an-oidc-client">Setting up an OIDC Client<a class="hash-link" href="#setting-up-an-oidc-client" title="Direct link to heading">​</a></h2><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Instructions</summary><div><div class="collapsibleContent_i85q"><p>We need to create a <a href="https://www.keycloak.org/docs/latest/server_admin/#con-oidc_server_administration_guide" target="_blank" rel="noopener noreferrer">OpenID Connect</a> Client in Keycloak for the app to communicate with. Keycloak&#x27;s <a href="https://www.keycloak.org/docs/latest/server_admin/#_oidc_clients" target="_blank" rel="noopener noreferrer">docs</a> provide steps for how to create an OIDC client and all the various configurations that can be introduced. Follow the steps below to create a client and get the right information necessary for app configuration.</p><ol><li><p>Open the Admin UI by clicking <strong>Open Console</strong> in the Phase Two Dashboard.</p></li><li><p>Click <strong>Clients</strong> in the menu.</p></li><li><p>Click <strong>Create client</strong>.</p></li><li><p>Leave <strong>Client type</strong> set to <strong>OpenID Connect</strong>.</p></li><li><p>Enter a <strong>Client ID</strong>. This ID is an alphanumeric string that is used in OIDC requests and in the Keycloak database to identify the client.</p></li><li><p>Supply a <strong>Name</strong> for the client.</p></li><li><p>Click <strong>Next</strong>.</p><p><img loading="lazy" alt="Keycloak OIDC Create Client General Settings" src="/assets/images/general-settings-0a3265fecd73272214fb1d3d9c4a57a7.png" width="3000" height="2072" class="img_ev3q"></p></li><li><p>Under the Capability Config section, leave the defaults as selected. This can be configured further later.</p><ul><li>Client authentication to Off.</li><li>Authorization to Off.</li><li>Standard flow checked. Direct access grants checked. All other items unchecked.</li></ul></li><li><p>Click <strong>Next</strong>.</p><p><img loading="lazy" alt="Keycloak OIDC Create Client Capability Config " src="/assets/images/capability-config-995c6bc68516bc541a9372f1bce7ad86.png" width="3000" height="2068" class="img_ev3q"></p></li><li><p>Under Login settings we need to add a redirect URI and Web origin in order. Assuming you are using the example applicaiton:</p><p><em>Valid redirect URI</em> (allows redirect back to application)</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">http://localhost:3000/*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>Web origins</em> (allows for Token auth call)</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">http://localhost:3000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>URI and Origin Details</summary><div><div class="collapsibleContent_i85q"><p>The choice of <code>localhost</code> is arbitrary. If you are using an example application running locally, this will apply. If you are using an app that you actually have deployed somewhere, then you will need to substitute the appropriate URI for that.</p></div></div></details></li><li><p>Click <strong>Save</strong></p><p><img loading="lazy" alt="Keycloak OIDC Create Login Settings" src="/assets/images/login-settings-7706affb95f5f93f7490d7b46f9ec1f4.png" width="3000" height="2074" class="img_ev3q"></p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="oidc-config">OIDC Config<a class="hash-link" href="#oidc-config" title="Direct link to heading">​</a></h3><p>We will need values to configure our application. To get these values follow the instructions below.</p><ol><li><p>Click <strong>Clients</strong> in the menu.</p></li><li><p>Find the Client you just created and click on it. In the top right click the <strong>Action</strong> dropdown and select <strong>Download adapter config</strong>.</p></li><li><p>Select <strong>Keycloak OIDC JSON</strong> in the format option. The details section will populate with the details we will need.</p><ul><li>Note the <code>realm</code>, <code>auth-server-url</code>, and <code>resource</code> values.</li></ul><p><img loading="lazy" alt="Keycloak OIDC Create Client Adapter Config" src="/assets/images/adapter-config-c561561514672a51754146ff56e6bbe3.png" width="3000" height="2081" class="img_ev3q"></p></li></ol></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="adding-a-non-admin-user">Adding a Non-Admin User<a class="hash-link" href="#adding-a-non-admin-user" title="Direct link to heading">​</a></h2><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Instructions</summary><div><div class="collapsibleContent_i85q"><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>It is bad practice to use your Admin user to sign in to an Application.</p></div></div><p>Since we do not want to use our Admin user for signing into the app we will build, we need to add a another non-admin user.</p><ol><li>Open the Admin UI by clicking <strong>Open Console</strong> in the Phase Two Dashboard.</li><li>Click <strong>Users</strong> in the menu.</li><li>Click <strong>Add user</strong>.</li><li>Fill out the information for Email, First name, and Last name. Click <strong>Create</strong>.</li><li>We will now set the password for this user manually. Click <strong>Credentials</strong> (tab) and click <strong>Set Password</strong>. Provide a password for this user. For our use case, as a tutorial, you can leave &quot;Temporary&quot; set to &quot;Off&quot;.</li><li>Click <strong>Save</strong> and confirm the password by clicking <strong>Save password</strong></li></ol></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-a-reactjs-project">Setting up a ReactJS Project<a class="hash-link" href="#setting-up-a-reactjs-project" title="Direct link to heading">​</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>We will use the Phase Two ReactJS example code here, but the logic could easily be applied to any existing application.</p></div></div><ol><li><p>Clone the Phase Two <a href="https://github.com/p2-inc/examples/" target="_blank" rel="noopener noreferrer">example repo</a>.</p></li><li><p>Open the ReactJS <a href="https://github.com/p2-inc/examples/tree/main/frameworks/reactjs" target="_blank" rel="noopener noreferrer">folder</a> within <code>/frameworks/reactjs</code>.</p></li><li><p>Run <code>npm install</code> and then <code>npm start</code>. This example leverages <a href="https://github.com/authts/react-oidc-context/tree/f175dcba6ab09871b027d6a2f2224a17712b67c5" target="_blank" rel="noopener noreferrer">react-oidc-context</a> (which uses <a href="https://github.com/authts/oidc-client-ts" target="_blank" rel="noopener noreferrer">oidc-client-ts</a>) to provide hook and HOC support.</p></li><li><p>Open the <code>index.tsx</code> file. We will be updating a few values from the prior section where we set up our OIDC client. Taking the values from the OIDC Client Config section, set those values in the code.</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> authServerUrl </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://euc1.auth.ac/auth/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> realm </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;shared-deployment-001&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> client </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;reg-example-1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Those are used to popluate the OIDC config</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> oidcConfig </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">authority</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">authServerUrl</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string string" style="color:rgb(195, 232, 141)">realms/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">realm</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">client_id</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">redirect_uri</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;http://localhost:3000/authenticated&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">onSigninCallback</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter literal-property property">args</span><span class="token parameter operator" style="color:rgb(137, 221, 255)">:</span><span class="token parameter"> any</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token dom variable" style="color:rgb(191, 199, 213)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">history</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">replaceState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token dom variable" style="color:rgb(191, 199, 213)">document</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token dom variable" style="color:rgb(191, 199, 213)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">pathname</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The config is then provided to the <code>AuthProvider</code>.</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">AuthProvider</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain">oidcConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">App</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token maybe-class-name">AuthProvider</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>At this point our entire applicationw will be able to access all information and methods needed to perform authentication. View <code>Auth.tsx</code> for exactly how the code is authenticating your user. The sections rendering the &quot;Log in&quot; and &quot;Log out&quot; buttons are conditional areas based on the authenticated context.</p><p>The logic using the hook to conditionally determine the Authenticated state, can be used to secure routes, components, and more.</p></li><li><p>Open <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">localhost:3000</a>. You will see the Phase Two example landing page. You current state should be &quot;Not authenticated&quot;. Click <strong>Log In</strong>. This will redirect you to your login page.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Use the non-admin user created in the previous section to sign in.</p></div></div></li><li><p>Enter the credentials of the non-admin user you created. Click <strong>Submit</strong>. You will then be redirected to the application. The Phase Two example landing page now loads your &quot;Authenticated&quot; state, displaying your user&#x27;s email and their Token.</p></li><li><p>After your first log in, click <strong>Log out</strong>. Then click <strong>Log in</strong> again. Notice how this time you will not be redirected to sign in as your state is already in the browser. Neat! If you clear the browser state for that tab, then you will have to be redirected away to sign-in again.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="learning-more">Learning more<a class="hash-link" href="#learning-more" title="Direct link to heading">​</a></h2><p>Phase Two&#x27;s enhanced Keycloak provides many ways to quickly control and tweak the log in and user management experience. Our <a href="https://phasetwo.io/blog" target="_blank" rel="noopener noreferrer">blog</a> has many use cases from <a href="https://phasetwo.io/blog/customizing-login-pages" target="_blank" rel="noopener noreferrer">customizing login pages</a>, setting up <a href="https://phasetwo.io/blog/set-up-magic-links" target="_blank" rel="noopener noreferrer">magic links</a> (password-less sign in), and <a href="https://phasetwo.io/product/organizations" target="_blank" rel="noopener noreferrer">Organization</a> workflows.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/phase-two/">phase_two</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tutorial/">tutorial</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/frameworks/">frameworks</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/reactjs/">reactjs</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/react/">react</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/authentication/">authentication</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/authorization/">authorization</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/sso/">sso</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Phase Two</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/about/">About</a></li><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/careers/">Careers</a></li></ul></div><div class="col footer__col"><div class="footer__title">Product</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" activebasepath="product/sso" href="/product/sso/">SSO</a></li><li class="footer__item"><a class="footer__link-item" activebasepath="product/identity" href="/product/identity/">Identity</a></li><li class="footer__item"><a class="footer__link-item" activebasepath="product/organizations" href="/product/organizations/">Organizations</a></li><li class="footer__item"><a class="footer__link-item" activebasepath="product/adminportal" href="/product/adminportal/">Admin Portal</a></li><li class="footer__item"><a class="footer__link-item" activebasepath="product/onprem" href="/product/onprem/">On-Prem</a></li></ul></div><div class="col footer__col"><div class="footer__title">Developers</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/api/phase-two-admin-rest-api/">API</a></li><li class="footer__item"><a href="https://github.com/p2-inc" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Support</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/p2-inc/phasetwo/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bugs &amp; Feature Requests<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="mailto:support@phasetwo.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">support@phasetwo.io<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://dev.to/phasetwo" target="_blank" rel="noopener noreferrer" class="footer__link-item">DEV.to<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCUY2ZvxI0hxpTWO_8w7MjVw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/privacy/">Privacy Policy</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/terms/">Terms of Use</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/subprocessors/">Subprocessors</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/service-agreement/">Service Agreement</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sla/">SLA</a></li></ul></div><div class="col footer__col"><div class="footer__title"> </div><ul class="footer__items clean-list"><li class="footer__item">
                <img class="footer-logo" src="https://phasetwo.io/img/logo_phase_slash.svg" alt="PhaseTwo" width="114" height="51">
              </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Phase Two, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.670949fd.js"></script>
<script src="/assets/js/main.9e36dd42.js"></script>
</body>
</html>